"use strict";function GlobalizationService(a,b,c){function d(a){h.dictionary=a,h.resourceFileLoaded=!0,b.$broadcast("localizeResourcesUpdates")}function e(){var b="/i18n/resources-locale_"+h.language+".js";a({method:"GET",url:b,cache:!1}).success(d).error(function(){var b="/i18n/resources-locale_default.js";a({method:"GET",url:b,cache:!1}).success(d)})}function f(a){var b="";if(h.dictionary!==[]&&h.dictionary.length>0){var c=h.dictionary[0][a];null!==c&&void 0!==c&&(b=c)}return b}var g={fr:{INDEX_WELCOME_LABEL:"Bienvenue",INDEX_SEARCH_FREE_SLOT_BUTTON:"Chercher salles libres",INDEX_PERIODIC_BOOKING_BUTTON:"Réservations périodiques",INDEX_ADMIN_CONSOLE_BUTTON:"Administration",INDEX_ACCOUNT_BUTTON:"Mon compte",INDEX_LOGIN_BUTTON:"S'authentifier",INDEX_LOGOFF_BUTTON:"Se déconnecter"},"fr-FR":{INDEX_WELCOME_LABEL:"Bienvenue",INDEX_SEARCH_FREE_SLOT_BUTTON:"Chercher salles libres",INDEX_PERIODIC_BOOKING_BUTTON:"Réservations périodiques",INDEX_ADMIN_CONSOLE_BUTTON:"Administration",INDEX_ACCOUNT_BUTTON:"Mon compte",INDEX_LOGIN_BUTTON:"S'authentifier",INDEX_LOGOFF_BUTTON:"Se déconnecter"},en:{INDEX_WELCOME_LABEL:"Welcome",INDEX_SEARCH_FREE_SLOT_BUTTON:"Search free slot",INDEX_PERIODIC_BOOKING_BUTTON:"Periodic bookings",INDEX_ADMIN_CONSOLE_BUTTON:"Administration",INDEX_ACCOUNT_BUTTON:"My account",INDEX_LOGIN_BUTTON:"Login",INDEX_LOGOFF_BUTTON:"Logoff"},"en-US":{INDEX_WELCOME_LABEL:"Welcome",INDEX_SEARCH_FREE_SLOT_BUTTON:"Search free slot",INDEX_PERIODIC_BOOKING_BUTTON:"Periodic bookings",INDEX_ADMIN_CONSOLE_BUTTON:"Administration",INDEX_ACCOUNT_BUTTON:"My account",INDEX_LOGIN_BUTTON:"Login",INDEX_LOGOFF_BUTTON:"Logoff"}},h={language:c.navigator.userLanguage||c.navigator.language,dictionary:[],resourceFileLoaded:!1};h.dictionary.push(g[h.language]),e();var i={};return i.localize=h,i.getLocalizedString=f,i.initLocalizedResources=e,i.successCallback=d,i}function SharedService(a){var b={};return b.message="",b.calendar=[],b.booking={},b.callerName="",b.prepForBroadcast=function(a){this.message=a,this.broadcastItem()},b.broadcastItem=function(){a.$broadcast("handleBroadcast")},b.prepForNewBookingAddedBroadcast=function(){this.broadcastNewBookingAdded()},b.broadcastNewBookingAdded=function(){a.$broadcast("newBookingsAddedBroadcast")},b.prepForBookingValidatedBroadcast=function(a,b,c){this.calendar=a,this.booking=b,this.callerName=c,this.broadcastBookingValidated()},b.broadcastBookingValidated=function(){a.$broadcast("BookingValidated")},b}function DatabaseService(a){function b(b){var c=F+"CRUD.php?action=get_booking",d={id:b};return a.post(c,d)}function c(b,c){var d=F+"CRUD.php?action=get_day_bookings",e={day:b,room:c};return a.post(d,e)}function d(b){var c=F+"CRUD.php?action=get_conflicted_bookings",d={day:b.day,room:b.room,year:b.year,scheduleStart:b.scheduleStart,scheduleEnd:b.scheduleEnd,id:void 0===b.id?null:b.id};return a.post(c,d)}function e(){var b=F+"CRUD.php?action=get_all_booking",c={};return a.get(b,c)}function f(b,c,d){var e=F+"CRUD.php?action=get_week_booking",f={year:b,week:c,room:d};return a.post(e,f)}function g(b,c){var d=F+"CRUD.php?action=add_booking",e={room:b.room,scheduleStart:b.scheduleStart,scheduleEnd:b.scheduleEnd,day:b.day,week:b.week,year:b.year,bookedBy:b.bookedBy,authToken:c,isValidated:void 0===b.isValidated?!1:b.isValidated,isPeriodic:void 0===b.isPeriodic?!1:b.isPeriodic};return a.post(d,e)}function h(b,c,d){var e=F+"CRUD.php?action=delete_booking",f={id:b,authToken:d,username:c};return a.post(e,f)}function i(b,c,d){var e=F+"CRUD.php?action=update_booking",f={id:b.id,room:c,scheduleStart:b.scheduleStart,scheduleEnd:b.scheduleEnd,day:b.day,week:b.week,year:b.year,bookedBy:b.bookedBy,isValidated:b.isValidated,authToken:d};return a.post(e,f)}function j(b,c){var d=F+"CRUD.php?action=validate_booking",e={id:b,isValidated:!0,authToken:c};return a.post(d,e)}function k(b,c){var d=F+"CRUD.php?action=delete_bookings",e={bookingsIds:b,authToken:c};return a.post(d,e)}function l(){var b=F+"CRUD.php?action=get_bookers",c={};return a.get(b,c)}function m(b,c){var d=F+"CRUD.php?action=get_booker_email",e={booker:b,authToken:c};return a.post(d,e)}function n(b,c){var d=F+"CRUD.php?action=update_booker",e={newName:b.booker,oldName:b.oldName,newColor:b.color,authToken:c};return a.post(d,e)}function o(b,c){var d=F+"CRUD.php?action=update_booker_settings",e={booker:b.oldBooker,newBooker:b.booker,email:b.email,password:b.password,newPassword:void 0===b.newPassword?-1:b.newPassword,authToken:c};return a.post(d,e)}function p(b,c){var d=F+"CRUD.php?action=delete_booker",e={booker:b.booker,authToken:c};return a.post(d,e)}function q(){var b=F+"CRUD.php?action=get_rooms",c={};return a.get(b,c)}function r(b,c){var d=F+"CRUD.php?action=update_room",e={newName:b.name,oldName:b.oldName,authToken:c};return a.post(d,e)}function s(b,c){var d=F+"CRUD.php?action=add_room",e={newName:b.name,authToken:c};return a.post(d,e)}function t(b,c){var d=F+"CRUD.php?action=delete_room",e={roomName:b.name,authToken:c};return a.post(d,e)}function u(b,c){var d=F+"CRUD.php?action=authenticate",e={username:b,encodedPassword:c};return a.post(d,e)}function v(b,c,d,e){var f=F+"CRUD.php?action=register",g={email:b,username:c,encodedPassword:d,adminToken:e};return a.post(f,g)}function w(a){F=a}function x(){return F}function y(b){var c=F+"CRUD.php?action=generateAdminToken",d={adminAuthToken:b};return a.post(c,d)}function z(b,c,d){var e=F+"CRUD.php?action=get_free_rooms_for_slot",f={day:b,scheduleStart:c,scheduleEnd:d};return a.post(e,f)}function A(b,c){var d=F+"CRUD.php?action=get_periodic_bookings",e={booker:b,authToken:c};return a.post(d,e)}function B(b,c){var d=F+"CRUD.php?action=get_periodic_booking",e={periodicBookingID:b,authToken:c};return a.post(d,e)}function C(b,c,d){var e=F+"CRUD.php?action=add_periodic_booking",f={periodicBookingStartingDay:b.periodicBookingStartingDay,periodicBookingStartingMonth:b.periodicBookingStartingMonth,periodicBookingStartingYear:b.periodicBookingStartingYear,periodicBookingScheduleStart:b.periodicBookingScheduleStart,periodicBookingScheduleEnd:b.periodicBookingScheduleEnd,periodicBookingWeeksDuration:b.periodicBookingWeeksDuration,room:b.room,booker:c,authToken:d};return a.post(e,f)}function D(b,c,d,e,f,g){var h=F+"CRUD.php?action=delete_periodic_booking",i={periodicBookingID:b,username:c,currentWeek:d,dayStr:e,leftWeekDuration:f,authToken:g};return a.post(h,i)}function E(b,c,d){var e=F+"CRUD.php?action=validate_periodic_booking",f={periodicBookingID:b,isValidated:!0,authToken:d};return a.post(e,f)}var F="http://localhost/",G={};return G.getBookingDB=b,G.getAllBookingDB=e,G.getWeekBookingDB=f,G.addBookingDB=g,G.deleteBookingDB=h,G.updateBookingDB=i,G.getRoomsDB=q,G.getBookersDB=l,G.updateBookerDB=n,G.deleteBookerDB=p,G.validateBookingDB=j,G.authenticate=u,G.register=v,G.setServerAddress=w,G.getServerAddress=x,G.generateAdminToken=y,G.deleteBookingsDB=k,G.updateRoomDB=r,G.deleteRoomDB=t,G.getFreeRoomsForSlot=z,G.getBookerEmailDB=m,G.updateBookerSettingsDB=o,G.addRoomDB=s,G.getPeriodicBookingsDB=A,G.addPeriodicBookingDB=C,G.deletePeriodicBookingDB=D,G.validatePeriodicBookingDB=E,G.getPeriodicBookingDB=B,G.getConflictedBookingsDB=d,G.getDayBookingsDB=c,G}function CommonService(a,b,c,d){function e(b,c,e,f,g){var h=b;a.validateBookingDB(h.id,c).then(function(){h.isValidated=!0,d.prepForBookingValidatedBroadcast(e,h,f)},g)}function f(b,c,d,e,f){if(d!==[]){for(var g=[],h=0;h<d.length;h++){var i=d[h].id;c!==i&&g.push(d[h].id)}a.deleteBookingsDB(g,b).then(e,f)}}function g(a,b,c){if(void 0!==b&&void 0!==a)for(var d=parseFloat(a.scheduleStart),e=a.id,f=parseFloat(a.scheduleEnd),g=0;g<b.length;g++){var h=b[g],i=h.scheduleStart,j=parseFloat(h.scheduleEnd);e!==h.id&&a.day===h.day&&parseInt(a.year)===parseInt(h.year)&&f>i&&j>d&&c.push(angular.copy(h))}}function h(a,b,c,d,e,f,g,h){i(a,c,d,e,h),j(a.id,c,b,f,g,h)}function i(d,e,f,g,h){a.getBookerEmailDB(d.bookedBy,e).then(function(a){var h=a.data.email,i="admin@admin.fr",j="",k=(d.scheduleStart+"h").replace(".5h","h30"),l=(d.scheduleEnd+"h").replace(".5h","h30"),m=c.getLocalizedString(f),n=c.getLocalizedString(g);m=m.replace("<BOOKING_DAY>",d.day).replace("<BOOKING_SCHEDULE_START>",k).replace("<BOOKING_SCHEDULE_END>",l),n=n.replace("<BOOKING_DAY>",d.day).replace("<BOOKING_SCHEDULE_START>",k).replace("<BOOKING_SCHEDULE_END>",l),b.sendEmail(i,h,j,m,n,e)},h)}function j(b,c,d,e,f,g){if(void 0!==d)for(var h=0;h<d.length;h++){var i=d[h];i.id!==b&&a.getBookerEmailDB(i.bookedBy,c).then(k(i,c,e,f),g)}}function k(a,b,c,d){return function(e){l(e,a,b,c,d)}}function l(a,d,e,f,g){var h=a.data.email,i="admin@admin.fr",j="",k=(d.scheduleStart+"h").replace(".5h","h30"),l=(d.scheduleEnd+"h").replace(".5h","h30"),m=c.getLocalizedString(f),n=c.getLocalizedString(g);m=m.replace("<BOOKING_DAY>",d.day).replace("<BOOKING_SCHEDULE_START>",k).replace("<BOOKING_SCHEDULE_END>",l),n=n.replace("<BOOKING_DAY>",d.day).replace("<BOOKING_SCHEDULE_START>",k).replace("<BOOKING_SCHEDULE_END>",l),b.sendEmail(i,h,j,m,n,e)}var m={};return m.validateBooking=e,m.getBookingsSharingSlot=g,m.sendEmails=h,m.sendConfirmationEmail=i,m.sendCancelationEmails=j,m.sendCancelationEmail=l,m.cancelConflictedBookings=f,m}function EmailService(a){function b(b,d,e,f,g,h){var i=c+"emailSending.php",j={from:b,to:d,cc:e,subject:f,message:g,adminAuthToken:h};return a.post(i,j)}var c="http://localhost/",d={};return d.sendEmail=b,d}function AuthenticationService(a,b,c,d,e,f){function g(a,b){return e.authenticate(a,b)}function h(d,e,g){var h={token:e,username:d,isAdmin:g};c.globals=h,f.prepForBroadcast(h),a.defaults.headers.common.Authorization="Basic "+e,b.put("globals",c.globals)}function i(){var d={token:void 0,username:void 0,isAdmin:!1};c.globals=d,f.prepForBroadcast(d),b.remove("globals"),a.defaults.headers.common.Authorization="Basic"}var j={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g="",h="",i="",j=0;do b=a.charCodeAt(j++),c=a.charCodeAt(j++),h=a.charCodeAt(j++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+this.keyStr.charAt(d)+this.keyStr.charAt(e)+this.keyStr.charAt(f)+this.keyStr.charAt(i),b=c=h="",d=e=f=i="";while(j<a.length);return g},decode:function(a){var b,c,d,e,f,g="",h="",i="",j=0,k=/[^A-Za-z0-9\+\/\=]/g;if(k.exec(a))return void 0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=this.keyStr.indexOf(a.charAt(j++)),e=this.keyStr.indexOf(a.charAt(j++)),f=this.keyStr.indexOf(a.charAt(j++)),i=this.keyStr.indexOf(a.charAt(j++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,h=(3&f)<<6|i,g+=String.fromCharCode(b),64!==f&&(g+=String.fromCharCode(c)),64!==i&&(g+=String.fromCharCode(h)),b=c=h="",d=e=f=i="";while(j<a.length);return g}},k={};return k.SetCredentials=h,k.ClearCredentials=i,k.Login=g,k.encodeDecode=j,k}angular.module("localization",[]).factory("globalizationService",GlobalizationService),GlobalizationService.$inject=["$http","$rootScope","$window"],angular.module("localization").filter("i18n",["globalizationService",function(a){return function(b){return a.getLocalizedString(b)}}]),angular.module("calendarApp",["ngAria","ngCookies","ngMessages","ngRoute","angularMoment","ngSanitize","ui.bootstrap.materialPicker","localization"]).directive("trustedHTML",["$sce",function(a){return{require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(b){return a.trustAsHTML(b)})}}}]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/loginout/:param",{templateUrl:"views/login.html",controller:"loginController",controllerAs:"loginCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"registerController",controllerAs:"registerCtrl"}).when("/adminConsole",{templateUrl:"views/adminConsole.html",controller:"adminConsoleController",controllerAs:"adminConsoleCtrl"}).when("/userConsole",{templateUrl:"views/userConsole.html",controller:"userConsoleController",controllerAs:"userConsoleCtrl"}).when("/searchFreeSlot",{templateUrl:"views/freeSlot.html",controller:"freeSlotController",controllerAs:"freeSlotCtrl"}).when("/periodicBooking",{templateUrl:"views/periodicBooking.html",controller:"periodicBookingController",controllerAs:"periodicBookingCtrl"}).when("/",{templateUrl:"views/calendar.html",controller:"calendarController",controllerAs:"calendarCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("calendarApp").factory("sharedService",SharedService),SharedService.$inject=["$rootScope"],angular.module("calendarApp").factory("databaseService",DatabaseService),DatabaseService.$inject=["$http"],angular.module("calendarApp").factory("commonService",CommonService),CommonService.$inject=["databaseService","emailService","globalizationService","sharedService"],angular.module("calendarApp").factory("emailService",EmailService),EmailService.$inject=["$http"],angular.module("calendarApp").factory("authenticationService",AuthenticationService),AuthenticationService.$inject=["$http","$cookieStore","$rootScope","$timeout","databaseService","sharedService"],angular.module("calendarApp").controller("headerController",["$scope","$cookieStore","$location","sharedService","authenticationService",function(a,b,c,d,e){function f(){var b=d.message;a.username=b.username,a.username=void 0===a.username?a.guestName:a.username,a.isAdmin=b.isAdmin}a.guestName="Visiteur",a.username=a.guestName,a.isAdmin=!1;var g=b.get("globals");void 0!==g&&(a.isAdmin=g.isAdmin,a.username=g.username),this.logout=function(){e.ClearCredentials(),a.username=void 0,a.isAdmin=!1,c.path("/")},a.$on("handleBroadcast",f)}]),angular.module("calendarApp").controller("loginController",["$scope","$location","$routeParams","$timeout","authenticationService","globalizationService",function(a,b,c,d,e,f){a.username="",this.password="",a.dataLoading=!1,a.timeoutTime=5e3;var g=c.param;this.initLoginController=function(){"logout"===g&&(e.ClearCredentials(),a.error=void 0,b.path("/"))},this.login=function(){a.error=void 0,a.dataLoading=!0;var c=e.encodeDecode.encode(this.password);void 0!==c?e.Login(a.username,c).then(function(c){var d=c.data;e.SetCredentials(a.username,d.token,d.isAdmin),b.path("/")},a.handleErrorDBCallback):(a.error=f.getLocalizedString("LOGIN_ENCODE_PASSWORD_ERROR_MSG"),d(a.removeErrorMessage,a.timeoutTime))},a.handleErrorDBCallback=function(b){a.handleErrorDB(b.status,b.data)},a.handleErrorDB=function(b,c){void 0!==c&&void 0!==c.errorCode&&-1===c.errorCode&&e.ClearCredentials(),a.dataLoading=!1,a.error=c.error,d(a.removeErrorMessage,a.timeoutTime)},a.removeErrorMessage=function(){a.error=void 0},a.removeAdminMessage=function(){a.messageAdmin=void 0},a.removeMessage=function(){a.message=void 0}}]),angular.module("calendarApp").controller("registerController",["$scope","$timeout","databaseService","authenticationService","$location","globalizationService",function(a,b,c,d,e,f){this.username="",this.password="",this.email="",this.adminToken="",a.dataLoading=!1,a.error=void 0,a.timeoutTime=5e3,this.initRegisterCtrl=function(){},this.register=function(){a.dataLoading=!0;var g=d.encodeDecode.encode(this.password);void 0!==g?c.register(this.email,this.username,g,this.adminToken).then(function(){e.path("/loginout/login")},a.handleErrorDBCallback):(a.error=f.getLocalizedString("LOGIN_ENCODE_PASSWORD_ERROR_MSG"),b(a.removeErrorMessage,a.timeoutTime))},a.handleErrorDBCallback=function(b){a.handleErrorDB(b.status,b.data)},a.handleErrorDB=function(c,e){void 0!==e&&void 0!==e.errorCode&&-1===e.errorCode&&d.ClearCredentials(),a.dataLoading=!1,a.error=e.error,b(a.removeErrorMessage,a.timeoutTime)},a.removeErrorMessage=function(){a.error=void 0},a.removeAdminMessage=function(){a.messageAdmin=void 0},a.removeMessage=function(){a.message=void 0}}]),angular.module("calendarApp").controller("calendarController",["$scope","$http","$window","$cookieStore","$timeout","$interval","moment","databaseService","sharedService","authenticationService","emailService","globalizationService","commonService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.callerName="Calendar",a.guestName="Visiteur",a.colorOfValidatedBooking="#4caf50",a.colorOfValidatedBookingSelected="#8bc34a",a.calendar=[],a.booking={},a.authToken=void 0,a.username=a.guestName,a.week="",a.year="",a.weekStartEndDates="",a.bookerColorsStyles=[],a.rooms=[],a.buildingsRooms={},a.currentRoom=void 0,a.currentBuilding=void 0,a.error=void 0,a.dataLoading=!1,a.messageAdmin=void 0,a.message=void 0,a.timeoutTime=1e4,a.intervalRefreshCalendarTime=6e4,this.dateDisplay=g(),this.date=g(),this.numberOfDays=7,this.dateDisplay.locale(c.navigator.userLanguage||c.navigator.language),this.date.locale("fr"),this.todayMonth=this.date.month(),this.todayWeek=this.date.isoWeek(),this.todayYear=this.date.year(),this.colorOfSelectedBooking="#FFCDD2",this.isMouseUp=!0,this.bookingSlotSelectionIsGoingUp=!1,this.isNewBookingSelected=!1,a.isExistingBookingSelected=!1,this.daysDisplay=[],this.days=[],this.monthWeeks=[],this.currIndexOfWeeksArray=0,this.originCurrTime=void 0,this.aleardyDisplayedBookings=[],this.schedulesLabels=["0","0:30","1","1:30","2","2:30","3","3:30","4","4:30","5","5:30","6","6:30","7","7:30","8","8:30","9","9:30","10","10:30","11","11:30","12","12:30","13","13:30","14","14:30","15","15:30","16","16:30","17","17:30","18","18:30","19","19:30","20","20:30","21","21:30","22","22:30","23","23:30","0"],this.schedules=[0,.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5,10,10.5,11,11.5,12,12.5,13,13.5,14,14.5,15,15.5,16,16.5,17,17.5,18,18.5,19,19.5,20,20.5,21,21.5,22,22.5,23,23.5,24],a.$on("handleBroadcast",function(){var b=i.message;a.username=b.username,a.username=void 0===a.username?a.guestName:a.username,a.isAdmin=b.isAdmin,a.authToken=b.token,a.booking.bookedBy=a.username===a.guestName?void 0:a.username}),a.$on("newBookingsAddedBroadcast",function(){a.initWeekBookings()});var n=f(function(){a.initWeekBookings()},a.intervalRefreshCalendarTime);a.$on("$destroy",function(){f.cancel(n)}),this.initCalendar=function(){var b=d.get("globals");void 0!==b&&(a.authToken=b.token,a.username=b.username,a.isAdmin=b.isAdmin),a.booking.bookedBy=a.username===a.guestName?void 0:a.username,a.week=this.date.isoWeek(),a.year=this.date.year(),this.initRooms(),this.initBookers(),this.initCalendarDays(),this.initWeek()},this.initRooms=function(){h.getRoomsDB().then(function(b){var c=b.data;a.rooms=c,a.currentRoom=c[0].room,a.currentBuilding=a.rooms[0].building,a.initWeekBookings(),a.initBuildingsRooms(),a.error=void 0},a.handleErrorDBCallback)},a.initBuildingsRooms=function(){a.buildingsRooms={};for(var b=0;b<a.rooms.length;b++){var c=a.rooms[b];void 0===a.buildingsRooms[c.building]&&(a.buildingsRooms[c.building]={buildingRooms:[]}),a.buildingsRooms[c.building].buildingRooms.push(c.room)}},this.initBookers=function(){h.getBookersDB().then(function(b){a.bookerColorsStyles=b.data,a.error=void 0},a.handleErrorDBCallback)},a.initWeekBookings=function(){h.getWeekBookingDB(a.year,a.week,a.currentRoom).then(function(b){a.calendar=b.data,a.error=void 0},a.handleErrorDBCallback)},this.initCalendarDays=function(){this.days=[],this.date.isoWeek(a.week);for(var b=1;b<=this.numberOfDays;b++)this.days.push(this.date.isoWeekday(b).format("ddd DD-MM-YYYY"));this.daysDisplay=[],this.dateDisplay.isoWeek(a.week);for(var c=1;c<=this.numberOfDays;c++)this.daysDisplay.push(this.dateDisplay.isoWeekday(c).format("ddd DD-MM-YYYY"))},this.initWeek=function(){this.initWeekData(this.todayMonth,this.todayYear),this.setWeek(this.currIndexOfWeeksArray)},this.initWeekData=function(a,b){var c=this.date.month(a);this.dateDisplay.month(a),c.year(b);var d=c.startOf("month").isoWeek();this.monthWeeks=[];for(var e=0;6>e;e++){var f=[],h=g().week(d+e),i=h.isoWeek();h.startOf("week").date();for(var j=0;7>j;j++){var k=h.date(),l=h.format("MMM");h.add(1,"d"),f.push({day:k,month:l})}var m={week:i,monthDays:f,year:c.year()};this.monthWeeks.push(m),this.todayWeek===i&&(this.currIndexOfWeeksArray=e)}},this.setWeek=function(b){var c=this.monthWeeks[b],d=g().isoWeek(c.week).year(c.year),e=g().isoWeek(a.week).year(a.year);d.month()!==e.month()?(this.initWeekData(d.month()),a.week=d.isoWeek(),a.year=d.year(),this.initCalendarDays(),void 0!==a.currentRoom&&a.initWeekBookings(),a.weekStartEndDates=d.isoWeekday(1).format("DD")+" "+d.format("MMMM")+" - "+d.isoWeekday(7).format("DD")+" "+d.format("MMMM")):(a.week=c.week,a.year=c.year,this.initCalendarDays(),void 0!==a.currentRoom&&a.initWeekBookings(),a.weekStartEndDates=c.monthDays[0].day+" "+c.monthDays[0].month+" - "+c.monthDays[6].day+" "+c.monthDays[6].month)},this.selectRoom=function(b,c){a.currentRoom=b,a.currentBuilding=c,a.initWeekBookings()},this.getBooking=function(b,c,d,e){var f=!1;if(void 0!==a.calendar)for(var g=0;g<a.calendar.length;g++){var h=a.calendar[g];b===h.day&&d===parseInt(h.year)&&e>=parseFloat(h.scheduleStart)&&e<parseFloat(h.scheduleEnd)&&(f===!1&&(f=[]),f.push(angular.copy(h)))}return f},this.createLocalBooking=function(b,c,d,e){a.booking.id=void 0,a.booking.scheduleEnd=e+.5+"",a.booking.scheduleStart=e+"",a.booking.day=b,a.booking.isValidated=!1,a.booking.bookedBy=void 0===a.booking.bookedBy?" ":a.booking.bookedBy,this.originCurrTime=parseFloat(e)},this.mouseDown=function(b,c,d,e){void 0!==a.username&&a.username!==a.guestName&&this.isMouseUp===!0&&(this.isNewBookingSelected=!0,a.isExistingBookingSelected=!1,this.isMouseUp=!1,this.createLocalBooking(b,c,d,e))},this.mouseUp=function(){this.isMouseUp=!0,this.bookingSlotSelectionIsGoingUp=!1},this.mouseEnter=function(b,c){void 0!==a.username&&a.username!==a.guestName&&this.isMouseUp===!1&&a.booking.day===c&&(parseFloat(b)>=a.booking.scheduleStart&&this.bookingSlotSelectionIsGoingUp===!1?a.booking.scheduleEnd=parseFloat(b)+.5+"":this.originCurrTime<parseFloat(b)?(this.bookingSlotSelectionIsGoingUp=!1,a.booking.scheduleStart=this.originCurrTime+"",a.booking.scheduleEnd=parseFloat(b)+.5+""):((this.bookingSlotSelectionIsGoingUp===!1||void 0===a.booking.scheduleEnd)&&(a.booking.scheduleEnd=this.originCurrTime+.5+""),a.booking.scheduleStart=parseFloat(b)+"",this.bookingSlotSelectionIsGoingUp=!0))},this.selectBookingInDB=function(b){void 0!==b&&""!==b&&(h.getBookingDB(b).then(function(b){var c={},d=b.data;c.id=d.id,c.room=d.room,c.scheduleStart=parseFloat(d.scheduleStart)+"",c.scheduleEnd=parseFloat(d.scheduleEnd)+"",c.day=d.day,c.week=d.week,c.year=d.year,c.bookedBy=d.bookedBy,c.isValidated=d.isValidated,a.booking=c,a.error=void 0},a.handleErrorDBCallback),this.isNewBookingSelected=!1,a.isExistingBookingSelected=!0)},this.applyBookingColor=function(b){var c=b.split("$"),d=this.getBookerColor(c[0]);if(c.length>=2){var e=c[1],f=this.isBookingValidated(e);void 0!==a.booking&&void 0!==a.booking&&void 0!==a.booking.id&&a.booking.id===e&&(d=f?a.colorOfValidatedBookingSelected:this.colorOfSelectedBooking)}return d},this.getBookerColor=function(b){for(var c,d=0;d<a.bookerColorsStyles.length&&void 0===c;d++)b===a.bookerColorsStyles[d].booker&&(c=a.bookerColorsStyles[d].color);return void 0===c&&(c=a.bookerColorsStyles[0].color),c},this.getScheduleBookedBy=function(b,c,d,e){var f=[],g=this.getBooking(b,c,d,e);if(g!==!1)for(var h=0;h<g.length;h++)if(void 0!==g[h].bookedBy){var i=g[h],j=2*(parseFloat(i.scheduleEnd)-parseFloat(i.scheduleStart)),k=i.bookedBy+"$"+i.id+"$"+j;f.push(k)}return this.isSelectBookingSlotClass(e,b)!==!1&&f.push(a.username+"$"),f},this.hasBookingForSlot=function(a,b,c,d){var e=[],f=this.getBooking(a,b,c,d);if(f!==!1)for(var g=0;g<f.length;g++)if(void 0!==f[g].bookedBy){var h=f[g];e.push(h.bookedBy+"$"+h.id)}return e.length>0},this.isSelectBookingSlotClass=function(b,c){var d=!1;if(void 0!==a.username&&a.username!==a.guestName){var e=parseFloat(b);void 0!==a.booking&&this.isNewBookingSelected===!0&&a.booking.day===c&&(parseFloat(a.booking.scheduleStart)===e?d=!0:parseFloat(a.booking.scheduleEnd)===e+.5?d=!0:parseFloat(a.booking.scheduleEnd)>=e+.5&&parseFloat(a.booking.scheduleStart)<=e&&(d=!0))}return d},this.addBooking=function(){a.booking.bookedBy=a.username===a.guestName?void 0:a.username;var b={room:a.currentRoom,scheduleStart:a.booking.scheduleStart,scheduleEnd:a.booking.scheduleEnd,day:a.booking.day,week:a.week,year:a.year,bookedBy:a.booking.bookedBy,isValidated:a.booking.isValidated};a.dataLoading=!0,h.addBookingDB(b,a.authToken).then(function(c){b.id=c.data.id,a.calendar.push(b),a.dataLoading=!1,a.error=void 0},a.handleErrorDBCallback),a.booking={},a.booking.bookedBy=a.username===a.guestName?void 0:a.username},this.validateBooking=function(){m.validateBooking(a.booking,a.authToken,a.calendar,a.callerName,a.handleErrorDBCallback)},a.$on("BookingValidated",function(){if(a.callerName===i.callerName){var b=i.booking,c=i.calendar,d=[];m.getBookingsSharingSlot(b,c,d),m.sendEmails(b,d,a.authToken,"VALIDATION_EMAIL_SUBJECT","VALIDATION_EMAIL_BODY","CANCEL_EMAIL_SUBJECT","CANCEL_EMAIL_BODY",a.handleErrorDBCallback),m.cancelConflictedBookings(a.authToken,b.id,d,a.initWeekBookings,a.handleErrorDBCallback),a.messageAdmin=l.getLocalizedString("CALENDAR_BOOKING_VALIDATED_MSG"),a.dataLoading=!1}}),this.isBookingValidated=function(b){for(var c=!1,d=b,e=0;e<a.calendar.length;e++)if(a.calendar[e].id===d){c=a.calendar[e].isValidated;break}return c},this.deleteBooking=function(){h.deleteBookingDB(a.booking.id,a.username,a.authToken).then(function(){a.initWeekBookings(),a.message=l.getLocalizedString("CALENDAR_BOOKING_DELETED_MSG"),e(a.removeMessage,a.timeoutTime)},a.handleErrorDBCallback)},a.handleErrorDBCallback=function(b){a.handleErrorDB(b.status,b.data)},a.handleErrorDB=function(b,c){void 0!==c&&void 0!==c.errorCode&&-1===c.errorCode&&j.ClearCredentials(),a.dataLoading=!1,a.error=c.error,e(a.removeErrorMessage,a.timeoutTime)},a.removeErrorMessage=function(){a.error=void 0},a.removeAdminMessage=function(){a.messageAdmin=void 0},a.removeMessage=function(){a.message=void 0}}]),angular.module("calendarApp").controller("adminConsoleController",["$scope","$cookieStore","$timeout","$sce","databaseService","sharedService","authenticationService","globalizationService",function(a,b,c,d,e,f,g,h){a.adminToken="",a.adminTokenEndTime="",a.error=void 0,a.dataLoading=!1,a.rooms=[],a.bookers=[],a.timeoutTime=5e3,a.size=10,a.$on("handleBroadcast",function(){var b=f.message;a.authToken=b.token});var i=b.get("globals");void 0!==i&&(a.authToken=i.token),this.generateAdminToken=function(){a.error=void 0,a.dataLoading=!0;var d=b.get("globals");void 0!==d?e.generateAdminToken(d.token).then(function(b){var c=b.data;a.dataLoading=!1,a.adminToken=c.adminToken,a.adminTokenEndTime=c.adminTokenEndTime},a.handleErrorDBCallback):(a.dataLoading=!1,a.error=h.getLocalizedString("ADMIN_UNKNOWN_AUTH_KEY_MSG"),c(a.removeErrorMessage,a.timeoutTime))},a.initRooms=function(){a.rooms=[],a.dataLoading=!0,e.getRoomsDB().then(function(b){a.dataLoading=!1;for(var c=b.data,d=0;d<c.length;d++){var e={name:c[d].room,oldName:void 0,isNew:!1};a.rooms.push(e)}a.error=void 0},a.handleErrorDBCallback)},this.modifyRoom=function(a){a.oldName=a.name},this.updateRoomInDB=function(b){a.dataLoading=!0,e.addRoomDB(b,a.authToken).then(function(){a.dataLoading=!1,a.initRooms(),a.messageAdmin=h.getLocalizedString("ADMIN_ROOM_UPDATED_MSG"),c(a.removeAdminMessage,a.timeoutTime)},a.handleErrorDBCallback)},this.deleteRoomDB=function(b){a.dataLoading=!0,e.deleteRoomDB(b,a.authToken).then(function(){a.dataLoading=!1,a.initRooms(),a.messageAdmin=h.getLocalizedString("ADMIN_ROOM_DELETED_MSG"),c(a.removeAdminMessage,a.timeoutTime)},a.handleErrorDBCallback)},this.addNewRoom=function(){var b={name:h.getLocalizedString("ADMIN_NEW_ROOM_MSG"),oldName:void 0,isNew:!0};a.rooms.push(b)},a.initBookers=function(){a.dataLoading=!0,a.bookers=[],e.getBookersDB().then(function(b){a.dataLoading=!1;for(var c=b.data,d=0;d<c.length;d++){var e={booker:c[d].booker,color:c[d].color,oldName:void 0,isNew:!1};a.bookers.push(e)}a.error=void 0},a.handleErrorDBCallback)},this.modifyBooker=function(a){a.oldName=a.booker},this.updateBookerInDB=function(b){a.dataLoading=!0,e.updateBookerDB(b,a.authToken).then(function(){a.dataLoading=!1,a.initBookers(),a.messageAdmin=h.getLocalizedString("ADMIN_USER_UPDATED_MSG"),c(a.removeAdminMessage,a.timeoutTime)},a.handleErrorDBCallback)},this.deleteBookerDB=function(b){a.dataLoading=!0,e.deleteBookerDB(b,a.authToken).then(function(){a.dataLoading=!1,a.initBookers(),a.messageAdmin=h.getLocalizedString("ADMIN_USER_DELETED_MSG"),c(a.removeAdminMessage,a.timeoutTime)},a.handleErrorDBCallback)},a.handleErrorDBCallback=function(b){a.handleErrorDB(b.status,b.data)},a.handleErrorDB=function(b,d){void 0!==d&&void 0!==d.errorCode&&-1===d.errorCode&&g.ClearCredentials(),a.dataLoading=!1,a.error=d.error,c(a.removeErrorMessage,a.timeoutTime)},a.removeErrorMessage=function(){a.error=void 0},a.removeAdminMessage=function(){a.messageAdmin=void 0},a.removeMessage=function(){a.message=void 0}}]),angular.module("calendarApp").controller("userConsoleController",["$scope","$cookieStore","$timeout","databaseService","sharedService","authenticationService","globalizationService",function(a,b,c,d,e,f,g){a.timeoutTime=1e4,a.isUpdating=!1,a.booker={},a.message=void 0,a.dataLoading=!1,a.$on("handleBroadcast",function(){var b=e.message;a.authToken=b.token,a.booker.booker=b.username});var h=b.get("globals");void 0!==h&&(a.authToken=h.token,a.booker.oldBooker=h.username,a.booker.booker=h.username,a.isAdmin=h.isAdmin),a.initUser=function(){d.getBookerEmailDB(a.booker.booker,a.authToken).then(function(b){a.booker.email=b.data.email,a.booker.newPassword=void 0},a.handleErrorDBCallback)},this.updateBookerSettings=function(){a.dataLoading=!0,a.booker.password=f.encodeDecode.encode(a.booker.password),void 0!==a.booker.password?(void 0!==a.booker.newPassword&&(a.booker.newPassword=f.encodeDecode.encode(a.booker.newPassword)),void 0!==a.booker.newPassword?d.updateBookerSettingsDB(a.booker,a.authToken).then(function(){a.message=g.getLocalizedString("USER_UPDATE_SUCCESSFUL_MSG"),a.isUpdating=!1,a.dataLoading=!1,a.booker.newPassword=void 0,a.booker.password=void 0,f.SetCredentials(a.booker.booker,a.authToken,a.isAdmin),c(a.removeMessage,a.timeoutTime),a.initUser()},a.handleErrorDBCallback):(a.error=g.getLocalizedString("LOGIN_ENCODE_PASSWORD_ERROR_MSG"),c(a.removeErrorMessage,a.timeoutTime))):(a.error=g.getLocalizedString("LOGIN_ENCODE_PASSWORD_ERROR_MSG"),c(a.removeErrorMessage,a.timeoutTime))},this.enableUpdateSettings=function(){a.isUpdating=!0},a.handleErrorDBCallback=function(b){a.handleErrorDB(b.status,b.data)},a.handleErrorDB=function(b,d){void 0!==d&&void 0!==d.errorCode&&-1===d.errorCode&&f.ClearCredentials(),a.dataLoading=!1,a.error=d.error,c(a.removeErrorMessage,a.timeoutTime)},a.removeErrorMessage=function(){a.error=void 0},a.removeAdminMessage=function(){a.messageAdmin=void 0},a.removeMessage=function(){a.message=void 0}}]),angular.module("calendarApp").controller("freeSlotController",["$scope","$http","$cookieStore","$timeout","moment","databaseService","sharedService","authenticationService",function(a,b,c,d,e,f,g,h){e.locale("fr"),a.availableRooms=void 0,a.dataLoading=!1,a.week="",a.year="",a.slotsStatuses=[],a.timeoutTime=5e3,this.date=e(),this.scheduleStart=void 0,this.scheduleEnd=void 0,this.todayDate=this.date.date(),this.todayWeek=this.date.week(),this.todayMonth=this.date.month(),this.todayYear=this.date.year(),this.monthWeeks=[],this.selectedDay=this.todayDate,this.selectedMonth=this.todayMonth,this.selectedWeek=this.todayWeek,this.selectedYear=this.todayYear,this.day=this.date.format("ddd DD-MM-YYYY"),this.schedulesLabels=["0","0:30","1","1:30","2","2:30","3","3:30","4","4:30","5","5:30","6","6:30","7","7:30","8","8:30","9","9:30","10","10:30","11","11:30","12","12:30","13","13:30","14","14:30","15","15:30","16","16:30","17","17:30","18","18:30","19","19:30","20","20:30","21","21:30","22","22:30","23","23:30","0"],this.schedules=[0,.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5,10,10.5,11,11.5,12,12.5,13,13.5,14,14.5,15,15.5,16,16.5,17,17.5,18,18.5,19,19.5,20,20.5,21,21.5,22,22.5,23,23.5,24],
a.$on("handleBroadcast",function(){var b=g.message;a.username=b.username,a.isAdmin=b.isAdmin,a.authToken=b.token}),this.initSearch=function(){var b=c.get("globals");void 0!==b&&(a.authToken=b.token,a.username=b.username,a.isAdmin=b.isAdmin),this.initCalendar()},this.initCalendar=function(){a.week=this.date.week(),a.year=this.date.year(),this.initWeek()},this.initWeek=function(){this.initWeekData(this.todayMonth,this.todayYear),this.setWeek(this.currIndexOfWeeksArray)},this.initWeekData=function(a,b){var c=this.date.month(a);c.year(b);var d=c.startOf("month").week();this.monthWeeks=[];for(var f=0;6>f;f++){var g=[],h=e().week(d+f),i=h.week();h.startOf("week").date();for(var j=0;7>j;j++){var k=h.date(),l=h.month();h.add(1,"d"),g.push({day:k,month:l})}var m={week:i,monthDays:g,year:c.year()};this.monthWeeks.push(m),this.todayWeek===i&&(this.currIndexOfWeeksArray=f)}},this.setWeek=function(b){var c=this.monthWeeks[b];a.week=c.week,a.year=c.year,a.weekStartEndDates=c.monthDays[0].day+" "+c.monthDays[0].month+" - "+c.monthDays[6].day+" "+c.monthDays[6].month},this.searchFreeSlot=function(){a.dataLoading=!0,a.availableRooms=[],a.error=void 0,f.getFreeRoomsForSlot(this.day,this.scheduleStart,this.scheduleEnd).then(function(b){var c=b.data;a.slotsStatuses=[];for(var d=0;d<c.length;d++)a.availableRooms.push(c[d].freeRoom),a.slotsStatuses.push({isLoadingData:!1,isNewlyBooked:!1});a.dataLoading=!1},a.handleErrorDBCallback)},this.selectDay=function(a,b,c){void 0!==this.selectedDay&&void 0!==this.selectedWeek&&void 0!==this.selectedYear&&a.month!==this.selectedMonth&&this.initWeekData(a.month,c),this.selectedDay=a.day,this.selectedWeek=b,this.selectedMonth=a.month,this.selectedYear=c,this.day=this.date.year(c).month(a.month).date(a.day).format("ddd DD-MM-YYYY")},this.bookFreeSlot=function(b,c){var d=a.slotsStatuses[c],e={room:b,scheduleStart:this.scheduleStart,scheduleEnd:this.scheduleEnd,day:this.day,week:this.selectedWeek,year:this.selectedYear,bookedBy:a.username};d.isLoadingData=!0,f.addBookingDB(e,a.authToken).then(function(){d.isLoadingData=!1,d.isNewlyBooked=!0},a.handleErrorDBCallback)},a.handleErrorDBCallback=function(b){a.handleErrorDB(b.status,b.data)},a.handleErrorDB=function(b,c){void 0!==c&&void 0!==c.errorCode&&-1===c.errorCode&&h.ClearCredentials(),a.dataLoading=!1,a.error=c.error,d(function(){},a.timeoutTime)},a.removeErrorMessage=function(){a.error=void 0},a.removeAdminMessage=function(){a.messageAdmin=void 0},a.removeMessage=function(){a.message=void 0}}]),angular.module("calendarApp").controller("periodicBookingController",["$scope","$cookieStore","$timeout","$location","moment","sharedService","databaseService","globalizationService","emailService","authenticationService","commonService",function(a,b,c,d,e,f,g,h,i,j,k){e.locale("fr"),a.callerName="PeriodicBooking",a.dataLoading=!1,a.week="",a.year="",a.isAdmin=!1,a.periodicBookings=[],a.timeoutTime=5e3,a.rooms=[],a.formattedPeriodicBookings=[],a.bookingsSharingSlotToBeCancelled=[],a.bookingConflitLoading=[],a.nbConflicts=[],a.nbQueriesConflicts=[],a.nbQueriesPropagate=[],this.periodicBookingStartingDay=void 0,this.periodicBookingStartingWeek=void 0,this.periodicBookingStartingYear=void 0,this.periodicBookingScheduleStart=void 0,this.periodicBookingScheduleEnd=void 0,this.periodicBookingWeeksDuration=void 0,this.selectedStartDay=void 0,this.selectedEndDay=void 0,this.periodicBookingRoom=void 0,this.dateStart=e(),this.dateEnd=e(),this.todayDate=this.dateStart.date(),this.todayWeek=this.dateStart.week(),this.todayMonth=this.dateStart.month(),this.todayYear=this.dateStart.year(),this.monthWeeks=[[],[]],this.day=this.dateStart.format("ddd DD-MM-YYYY"),this.selectedStartDay=void 0,this.selectedStartMonth=void 0,this.selectedStartYear=void 0,this.selectedEndDay=void 0,this.selectedEndMonth=void 0,this.selectedEndYear=void 0,this.selectedStartingDate=void 0,this.selectedEndingDate=void 0,this.periodicDay=void 0,this.selectedEndWeek=void 0,this.schedulesLabels=["0","0:30","1","1:30","2","2:30","3","3:30","4","4:30","5","5:30","6","6:30","7","7:30","8","8:30","9","9:30","10","10:30","11","11:30","12","12:30","13","13:30","14","14:30","15","15:30","16","16:30","17","17:30","18","18:30","19","19:30","20","20:30","21","21:30","22","22:30","23","23:30","0"],this.schedules=[0,.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5,10,10.5,11,11.5,12,12.5,13,13.5,14,14.5,15,15.5,16,16.5,17,17.5,18,18.5,19,19.5,20,20.5,21,21.5,22,22.5,23,23.5,24],a.$on("handleBroadcast",function(){var b=f.message;a.username=b.username,a.isAdmin=b.isAdmin,a.authToken=b.token});var l=b.get("globals");void 0!==l&&(a.authToken=l.token,a.isAdmin=l.isAdmin,a.username=l.username),this.initPeriodicBooking=function(){this.initCalendar(),this.initRooms(),a.getPeriodicBookings()},this.initRooms=function(){g.getRoomsDB().then(function(b){var c=b.data;a.rooms=c,a.error=void 0},a.handleErrorDBCallback)},a.getPeriodicBookings=function(){a.dataLoading=!0,a.periodicBookings=[],g.getPeriodicBookingsDB(a.username,a.authToken).then(function(b){a.error=void 0,a.dataLoading=!1,a.periodicBookings=b.data,a.formatPeriodicBookings()},a.handleErrorDBCallback)},a.formatPeriodicBookings=function(){a.formattedPeriodicBookings=[];for(var b=0;b<a.periodicBookings.length;b++)try{var d=a.periodicBookings[b],f={day:e().date(d.periodicBookingStartingDay).month(d.periodicBookingStartingMonth).year(d.periodicBookingStartingYear).format("dddd"),dateStart:e().date(d.periodicBookingStartingDay).month(d.periodicBookingStartingMonth).year(d.periodicBookingStartingYear).format("ddd DD-MM-YYYY"),dateEnd:e().date(d.periodicBookingStartingDay).month(d.periodicBookingStartingMonth).year(d.periodicBookingStartingYear).add(d.periodicBookingWeeksDuration,"week").format("ddd DD-MM-YYYY"),scheduleStart:(d.periodicBookingScheduleStart+"h").replace(".5h","h30"),scheduleEnd:(d.periodicBookingScheduleEnd+"h").replace(".5h","h30"),periodicBookingWeeksDuration:d.periodicBookingWeeksDuration,id:d.id,room:d.room,isValidated:d.isValidated,bookedBy:d.bookedBy};a.formattedPeriodicBookings.push(f)}catch(g){a.error=g,c(a.removeErrorMessage,a.timeoutTime)}},this.addPeriodicBooking=function(){a.dataLoading=!0;var b={periodicBookingStartingDay:this.periodicBookingStartingDay,periodicBookingScheduleStart:this.periodicBookingScheduleStart,periodicBookingScheduleEnd:this.periodicBookingScheduleEnd,periodicBookingStartingMonth:this.selectedStartMonth,periodicBookingStartingYear:this.selectedStartYear,periodicBookingWeeksDuration:this.periodicBookingWeeksDuration,room:this.periodicBookingRoom};g.addPeriodicBookingDB(b,a.username,a.authToken).then(function(){a.error=void 0,a.dataLoading=!1,a.getPeriodicBookings(),a.message="Réservation périodique soumise.",c(a.removeMessage,a.timeoutTime)},a.handleErrorDBCallback)},this.deletePeriodicBooking=function(b){a.dataLoading=!0,g.getPeriodicBookingDB(b,a.authToken).then(function(d){var f=e().isoWeek(),h=d.data,i=e().date(h.periodicBookingStartingDay).month(h.periodicBookingStartingMonth).year(h.periodicBookingStartingYear).format("ddd"),j=e().date(h.periodicBookingStartingDay).month(h.periodicBookingStartingMonth).year(h.periodicBookingStartingYear),k=e().isoWeek()-j.isoWeek()-1,l=h.periodicBookingWeeksDuration-k;g.deletePeriodicBookingDB(b,a.username,f,i,l,a.authToken).then(function(){a.error=void 0,a.dataLoading=!1,a.getPeriodicBookings(),a.message="Réservation périodique supprimée.",c(a.removeMessage,a.timeoutTime)},a.handleErrorDBCallback),a.formatPeriodicBookings()},a.handleErrorDBCallback)},this.findConflictedSlotsWithPerdiodicBooking=function(b){a.bookingConflitLoading[b]=!0,a.nbConflicts[b]=0,a.nbQueriesConflicts[b]=0,a.bookingsSharingSlotToBeCancelled[b]=[],g.getPeriodicBookingDB(b,a.authToken).then(function(c){a.bookingsSharingSlotToBeCancelled[b]=[];for(var d=c.data,f=parseInt(d.periodicBookingWeeksDuration),h=e().date(d.periodicBookingStartingDay).month(d.periodicBookingStartingMonth).year(d.periodicBookingStartingYear),i=0;f>=i;i++){var j={room:d.room,scheduleStart:d.periodicBookingScheduleStart,scheduleEnd:d.periodicBookingScheduleEnd,day:h.format("ddd DD-MM-YYYY"),week:h.week(),year:h.year(),bookedBy:d.bookedBy,isValidated:!0,isPeriodic:!0};a.nbQueriesConflicts[b]++,g.getConflictedBookingsDB(j).then(a.getConflictedBookingsDBCallback(b),a.handleErrorDBCallback),h.add(1,"week")}},a.handleErrorDBCallback)},a.getConflictedBookingsDBCallback=function(b){return function(c){var d=c.data;a.nbConflicts[b]+=void 0===d?0:d.length,a.bookingsSharingSlotToBeCancelled[b].push(d),a.nbQueriesConflicts[b]--,a.nbQueriesConflicts[b]<=0&&(a.bookingConflitLoading[b]=!1,a.bookingsSharingSlotToBeCancelled[b]=a.mergeBookingsSharingSlotToBeCancelled(a.bookingsSharingSlotToBeCancelled[b]))}},a.mergeBookingsSharingSlotToBeCancelled=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++)b.push(d[e]);return b},this.validatePeriodicBooking=function(b){a.dataLoading=!0,g.validatePeriodicBookingDB(b,a.username,a.authToken).then(function(){a.error=void 0,a.propagatePerdiodicBookingValidation(b),a.getPeriodicBookings(),g.getPeriodicBookingDB(b,a.authToken).then(function(b){a.sendConfirmationEmail(b.data)},a.handleErrorDBCallback),a.message="Réservation périodique validée.",c(a.removeMessage,a.timeoutTime)},a.handleErrorDBCallback)},a.propagatePerdiodicBookingValidation=function(b){a.nbQueriesPropagate[b]=0,g.getPeriodicBookingDB(b,a.authToken).then(function(c){var d=c.data,h=e().date(d.periodicBookingStartingDay).month(d.periodicBookingStartingMonth).year(d.periodicBookingStartingYear);k.sendCancelationEmails(d.id,a.authToken,a.bookingsSharingSlotToBeCancelled[b],"CANCEL_EMAIL_SUBJECT","CANCEL_EMAIL_BODY",a.handleErrorDBCallback),k.cancelConflictedBookings(a.authToken,d.id,a.bookingsSharingSlotToBeCancelled[b],a.emptyFunction,a.handleErrorDBCallback);for(var i=0;i<=d.periodicBookingWeeksDuration;i++){a.dataLoading=!0;var j={room:d.room,scheduleStart:d.periodicBookingScheduleStart,scheduleEnd:d.periodicBookingScheduleEnd,day:h.format("ddd DD-MM-YYYY"),week:h.week(),year:h.year(),bookedBy:d.bookedBy,isValidated:!0,isPeriodic:!0};h.add(1,"week"),a.nbQueriesPropagate[b]++,g.addBookingDB(j,a.authToken).then(a.addBookingDBCallback(j,b),a.handleErrorDBCallback)}f.prepForNewBookingAddedBroadcast()},a.handleErrorDBCallback)},a.addBookingDBCallback=function(b,c){return function(d){b.id=d.data.id,k.validateBooking(b,a.authToken,null,a.callerName,a.handleErrorDBCallback),a.nbQueriesPropagate[c]--,a.nbQueriesPropagate[c]<=0&&(a.dataLoading=!1)}},a.emptyFunction=function(){},a.sendConfirmationEmail=function(b){g.getBookerEmailDB(a.username,a.authToken).then(function(c){var d=c.data.email,e="admin@admin.fr",f="",g=(b.periodicBookingScheduleStart+"h").replace(".5h","h30"),j=(b.periodicBookingScheduleEnd+"h").replace(".5h","h30"),k=h.getLocalizedString("VALIDATION_PERIODIC_BOOKING_EMAIL_SUBJECT"),l=h.getLocalizedString("VALIDATION_PERIODIC_BOOKING_EMAIL_BODY");k=k.replace("<BOOKING_DAY>",b.periodicBookingStartingDay).replace("<BOOKING_SCHEDULE_START>",g).replace("<BOOKING_SCHEDULE_END>",j).replace("<BOOKING_WEEK_DURATION>",b.periodicBookingWeeksDuration),l=l.replace("<BOOKING_DAY>",b.periodicBookingStartingDay).replace("<BOOKING_SCHEDULE_START>",g).replace("<BOOKING_SCHEDULE_END>",j).replace("<BOOKING_WEEK_DURATION>",b.periodicBookingWeeksDuration),i.sendEmail(e,d,f,k,l,a.authToken)},a.handleErrorDBCallback)},this.initCalendar=function(){a.week=this.dateStart.week(),a.year=this.dateStart.year(),this.initWeek()},this.initWeek=function(){this.initWeekData(this.todayMonth,!0,this.todayYear),this.initWeekData(this.todayMonth,!1,this.todayYear)},this.initWeekData=function(a,b,c){var d=b===!0?0:1,f=b===!0?this.dateStart:this.dateEnd;f.month(a),f.year(c);var g=f.startOf("month").week();this.monthWeeks[d]=[];for(var h=0;6>h;h++){var i=[],j=e().week(g+h),k=j.week();j.startOf("week").date();for(var l=0;7>l;l++){var m=j.date(),n=j.month();j.add(1,"d"),i.push({day:m,month:n})}var o={week:k,monthDays:i,year:f.year()};this.monthWeeks[d].push(o),this.todayWeek===k&&(this.currIndexOfWeeksArray=h)}},this.selectStartingDay=function(a,b,c){if(void 0!==this.periodicBookingStartingDay&&void 0!==this.periodicBookingStartingWeek&&void 0!==this.periodicBookingStartingYear&&a.month!==this.selectedStartMonth&&this.initWeekData(a.month,!0,c),this.periodicBookingStartingDay=a.day,this.periodicBookingStartingWeek=b,this.periodicBookingStartingYear=c,this.selectedStartDay=a.day,this.selectedStartMonth=a.month,this.selectedStartYear=c,this.selectedStartingDate=e().date(this.periodicBookingStartingDay).week(this.periodicBookingStartingWeek).year(this.periodicBookingStartingYear).format("ddd DD-MM-YYYY"),this.periodicDay=e().date(this.periodicBookingStartingDay).week(this.periodicBookingStartingWeek).year(this.periodicBookingStartingYear).format("dddd"),void 0!==this.selectedEndDay&&void 0!==this.selectedEndWeek&&void 0!==this.selectedEndYear){var d=e().date(this.selectedEndDay).week(this.selectedEndWeek).year(this.selectedEndYear),f=e().date(a.day).week(b).year(c);this.periodicBookingWeeksDuration=d.isoWeek()-f.isoWeek()}},this.selectEndingDay=function(a,b,c){if(void 0!==this.selectedEndDay&&void 0!==this.selectedEndWeek&&void 0!==this.selectedEndYear&&a.month!==this.selectedEndMonth&&this.initWeekData(a.month,!1,c),this.selectedEndDay=a.day,this.selectedEndMonth=a.month,this.selectedEndWeek=b,this.selectedEndYear=c,this.selectedEndingDate=e().date(this.selectedEndDay).week(this.selectedEndWeek).year(this.selectedEndYear).format("ddd DD-MM-YYYY"),void 0!==this.periodicBookingStartingDay&&void 0!==this.periodicBookingStartingWeek&&void 0!==this.periodicBookingStartingYear){var d=e().date(this.periodicBookingStartingDay).week(this.periodicBookingStartingWeek).year(this.periodicBookingStartingYear),f=e().date(a.day).week(b).year(c);this.periodicBookingWeeksDuration=f.isoWeek()-d.isoWeek()}},a.handleErrorDBCallback=function(b){a.handleErrorDB(b.status,b.data)},a.handleErrorDB=function(b,d){-1===d.errorCode&&j.ClearCredentials(),a.dataLoading=!1,a.error=d.error,c(a.removeErrorMessage,a.timeoutTime)},a.removeErrorMessage=function(){a.error=void 0},a.removeAdminMessage=function(){a.messageAdmin=void 0},a.removeMessage=function(){a.message=void 0},this.daysAreSelected=function(){return void 0!==this.selectedStartingDate&&void 0!==this.periodicBookingWeeksDuration}}]),angular.module("calendarApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("calendarApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/adminConsole.html",'<div class="col-md-10 col-md-offset-2 container-fluid"> <div class="alert alert-danger" ng-show="error !== undefined" style="padding:2px;margin-bottom:2px"> {{error}} <a style="float: right" ng-click="removeErrorMessage()">x</a> </div> <div class="alert alert-success" ng-show="message !== undefined" style="padding:2px;margin-bottom:2px"> {{message}} <a style="float: right" ng-click="removeMessage()">x</a> </div> <div class="alert alert-success" ng-show="messageAdmin !== undefined" style="padding:2px;margin-bottom:2px"> {{messageAdmin}} <a style="float: right" ng-click="removeMessageAdmin()">x</a> </div> <div class="container-fluid" style="width:100%"> <ul class="nav nav-pills" role="pilllist"> <li class="active"><a data-toggle="pill" data-target="#adminAuthKeyGenerator"> {{\'ADMIN_GENERATING_ADMIN_TOKEN_TITLE\' | i18n}}</a></li> <li><a data-toggle="pill" data-target="#metrics"> {{\'ADMIN_METRICS_TITLE\' | i18n}} </a></li> <li><a data-toggle="pill" data-target="#roomManagement" ng-click="initRooms()"> {{\'ADMIN_ROOM_MANAGEMENT_TITLE\' | i18n}} </a></li> <li><a data-toggle="pill" data-target="#bookerManagement" ng-click="initBookers()"> {{\'ADMIN_USER_MANAGEMENT_TITLE\' | i18n}} </a></li> </ul> <img ng-show="dataLoading === true" src="/images/loading.4a8b692d.svg" alt="..." style="width: 15%; height: 15%"> <div class="tab-content"> <div ng-hide="dataLoading === true" id="adminAuthKeyGenerator" class="tab-pane fade in active"> <h2>{{\'ADMIN_GENERATE_ADMIN_TOKEN_LABEL\' | i18n}}</h2> <a ng-click="adminConsoleCtrl.generateAdminToken()"> <button type="button" class="btn btn-info" style="margin: 8px"> {{\'ADMIN_GENERATE_LABEL\' | i18n}} </button> </a> <p>{{\'ADMIN_KEY_LABEL\' | i18n}} {{adminToken}}</p> <p>{{\'ADMIN_END_OF_VALIDITY_LABEL\' | i18n}} {{adminTokenEndTime}}</p> </div> <div ng-hide="dataLoading === true" id="metrics" class="tab-pane fade"> <h2>{{\'ADMIN_METRICS_LABEL\' | i18n}}</h2> </div> <div ng-hide="dataLoading === true" id="roomManagement" class="tab-pane fade"> <ul id="roomList" class="list-group"> <li class="list-group-item" ng-repeat="room in rooms"> <input type="text" style="width:65%" ng-model="room.name" ng-disabled="room.isNew === false && room.oldName === undefined" required> <a ng-click="adminConsoleCtrl.deleteRoomDB(room)" style="float: right;margin-left:5px"> <button class="btn btn-danger"> {{\'ADMIN_DELETE_ROOM_LABEL\' | i18n}} </button> </a> <a ng-click="adminConsoleCtrl.modifyRoom(room)" ng-show="room.oldName === undefined" style="float: right;margin-left:5px"> <button class="btn btn-warning" ng-show="room.isNew === false && room.oldName === undefined"> {{\'ADMIN_UPDATE_ROOM_LABEL\' | i18n}} </button> </a> <a ng-click="adminConsoleCtrl.updateRoomInDB(room)" g-show="room.isNew === true || room.oldName !== undefined" style="float: right;margin-left:5px"> <button class="btn btn-success" ng-show="room.isNew === true || room.oldName !== undefined"> {{\'ADMIN_VALIDATE_ROOM_LABEL\' | i18n}} </button> </a> </li> </ul> <a ng-click="adminConsoleCtrl.addNewRoom()"> <button class="btn btn-info"> {{\'ADMIN_ADD_ROOM_LABEL\' | i18n}} </button> </a> </div> <div ng-hide="dataLoading" id="bookerManagement" class="tab-pane fade"> <h2>{{\'ADMIN_USERS_LABEL\' | i18n}}</h2> <ul id="bookersList" class="list-group"> <li class="list-group-item" ng-repeat="booker in bookers"> <input type="text" style="width:30%" ng-model="booker.booker" trusted-html ng-disabled="booker.isNew === false && booker.oldName === undefined" required>  <span class="glyphicon glyphicon-stop" ng-style="{color:booker.color}" style="padding:0px;margin-left:5px"></span> <material-picker ng-hide="booker.isNew === false && booker.oldName === undefined" ng-model="booker.color" format="\'hex\'" hover-model="hoverColor" size="size"></material-picker> <a ng-click="adminConsoleCtrl.deleteBookerDB(booker)" style="float: right;margin-left:5px"> <button class="btn btn-danger"> {{\'ADMIN_DELETE_USER_LABEL\' | i18n}} </button> </a> <a ng-click="adminConsoleCtrl.modifyBooker(booker)" ng-show="booker.oldName === undefined" style="float: right;margin-left:5px"> <button class="btn btn-warning" ng-show="booker.isNew === false && booker.oldName === undefined"> {{\'ADMIN_UPDATE_USER_LABEL\' | i18n}} </button> </a> <a ng-click="adminConsoleCtrl.updateBookerInDB(booker)" ng-show="booker.oldName !== undefined" style="float: right;margin-left:5px"> <button class="btn btn-success" ng-show="booker.isNew === true || booker.oldName !== undefined"> {{\'ADMIN_VALIDATE_USER_LABEL\' | i18n}} </button> </a> </li> </ul> </div> </div> </div> </div>'),a.put("views/calendar.html",'<div class="container-fluid table-responsive" ng-init="calendarCtrl.initCalendar()"style="height:100%;">\n    <div >\n        <div class="alert alert-danger" ng-show="error !== undefined" style="padding:2px;margin-bottom:2px;">\n            {{error}}\n            <a style="float: right" ng-click="removeErrorMessage()">x</a>\n        </div>\n        <div class="alert alert-success" ng-show="message !== undefined" style="padding:2px;margin-bottom:2px;">\n            {{message}}\n            <a style="float: right" ng-click="removeMessage()">x</a>\n        </div>\n        <div class="alert alert-success" ng-show="messageAdmin !== undefined" style="padding:2px;margin-bottom:2px;">\n            {{messageAdmin}}\n            <a style="float: right" ng-click="removeMessageAdmin()">x</a>\n        </div>\n        \n    </div>\n    <div class="innerInfoPage" >\n        <div   class="container-fluid innerInfoContent">\n            <table class="table-responsive table-hover" \n                style="margin-left: 2px;margin-bottom:5px;padding:0px;width:100%;" align="center">\n                <tr>\n                    <td >\n                        <button class="btn btn-default" style="padding:3px;" ng-click="calendarCtrl.initWeekData(calendarCtrl.date.month()-1)"><</button>\n                    </td>\n                    <td colspan="5" style="text-align:center;padding:2px;">\n                        {{calendarCtrl.dateDisplay.format("MMMM YYYY")}}\n                    </td>\n                    <td colspan="2">\n                        <button class="btn btn-default" style="padding:3px;" ng-click="calendarCtrl.initWeekData(calendarCtrl.date.month()+1)">></button>\n                    </td>\n                </tr>\n                <tr>\n                    <th style="text-align:center;padding:2px;margin-right:5px;">\n                        {{\'AGENDA_DAY1_LABEL\' | i18n}}\n                    </th>\n                    <th style="text-align:center;padding:2px;margin-right:5px;">\n                        {{\'AGENDA_DAY2_LABEL\' | i18n}}\n                    </th>\n                    <th style="text-align:center;padding:2px;margin-right:5px;">\n                        {{\'AGENDA_DAY3_LABEL\' | i18n}}\n                    </th>\n                    <th style="text-align:center;padding:2px;margin-right:5px;">\n                        {{\'AGENDA_DAY4_LABEL\' | i18n}}\n                    </th>\n                    <th style="text-align:center;padding:2px;margin-right:5px;">\n                        {{\'AGENDA_DAY5_LABEL\' | i18n}}\n                    </th>\n                    <th style="text-align:center;padding:2px;margin-right:5px;">\n                        {{\'AGENDA_DAY6_LABEL\' | i18n}}\n                    </th>\n                    <th style="text-align:center;padding:2px;margin-right:5px;">\n                        {{\'AGENDA_DAY7_LABEL\' | i18n}}\n                    </th>\n                </tr>\n                <tr ng-repeat="monthWeek in calendarCtrl.monthWeeks track by $index" ng-click="calendarCtrl.setWeek($index)" align="center">\n                    <th ng-class="{selectedClass: week === monthWeek.week  && monthWeek.year===calendarCtrl.todayYear, todayClass:monthWeek.week===calendarCtrl.todayWeek && monthWeek.year===calendarCtrl.todayYear}" ng-repeat="monthDay in monthWeek.monthDays track by $index" \n                        style="margin: 5px;padding:2px;font-weight: normal;text-align:center;" >\n                        {{monthDay.day}}\n                    </th>\n                </tr>\n            </table>\n            <div id="bookingInfo">\n                <div class="panel-group">\n                    <div class="panel panel-default">\n                        <div class="panel-heading" style="padding: 5px;">\n                            <p class="panel-title" style="font-size:14px;">\n                                {{\'CALENDAR_BOOKING\' | i18n}}\n                            </p>\n                        </div>\n                        <div id="bookingFormColl" class="panel-collapse collapse in" style="margin-left: 5px;">\n                            <form name="bookingDetailForm" ng-hide="booking == null" \n                                ng-submit="bookingDetailForm.$valid && calendarCtrl.addBooking()" novalidate>\n                                <div class="input-group" >\n                                    <label>{{\'CALENDAR_BOOKING_LABEL\' | i18n}}</label>\n                                    <select style="width:90%;" ng-model="booking.day" ng-disabled="username === undefined || username === \'\'" required>\n                                        <option ng-repeat="day in calendarCtrl.days track by $index" value="{{day}}">{{calendarCtrl.daysDisplay[$index]}}</option>\n                                    </select>\n                                </div>\n                                <div class="input-group">\n                                    <div  style="width:50%;float: left;">\n                                        <label style="">{{\'CALENDAR_SCHEDULE_FROM_LABEL\' | i18n}}</label>\n                                        <select ng-model="booking.scheduleStart" ng-disabled="username === undefined || username === \'\'" required>\n                                            <option ng-repeat="timeStart in calendarCtrl.schedules track by $index" \n                                                ng-disabled="booking.scheduleEnd !== undefined && timeStart >= booking.scheduleEnd"\n                                                value="{{timeStart}}">{{calendarCtrl.schedulesLabels[$index]}}</option>\n                                        </select>\n                                    </div>\n                                    <div style="width:50%;float: right;">\n                                        <label>{{\'CALENDAR_SCHEDULE_TO_LABEL\' | i18n}}</label><br>\n                                        <select ng-model="booking.scheduleEnd" ng-disabled="username === undefined || username === \'\'" required>\n                                            <option ng-repeat="timeEnd in calendarCtrl.schedules track by $index"\n                                                ng-disabled="booking.scheduleStart !== undefined && timeEnd <= booking.scheduleStart"\n                                                value="{{timeEnd}}">{{calendarCtrl.schedulesLabels[$index]}}</option>\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="input-group">\n                                    <label>{{\'CALENDAR_ROOM_LABEL\' | i18n}}</label>\n                                    <input style="width:90%;" type="text" name="room" ng-model="currentRoom" disabled required /> \n                                </div>\n                                <div class="input-group" >\n                                    <label>{{\'CALENDAR_BOOKED_BY_LABEL\' | i18n}}</label>\n                                    <input style="width:90%;" type="text" name="bookedBy" ng-model="booking.bookedBy" disabled  required />\n                                </div>\n                                <div class="input-group">\n                                    <label>{{\'CALENDAR_BOOKING_LABEL\' | i18n}}</label>\n                                    <input type="checkbox" name="isValidated" ng-checked="booking.isValidated === true" disabled/>\n                                    {{\'CALENDAR_VALIDATED_LABEL\' | i18n}}\n                                </div>\n                                <input class="btn btn-success" \n                                    ng-hide="dataLoading === true || booking.bookedBy === username && booking.isValidated === true" \n                                    type="submit" \n                                    ng-disabled="bookingDetailForm.$invalid || booking.day === undefined"\n                                    value="{{\'CALENDAR_BOOK_LABEL\' | i18n}}" \n                                    style="margin: 3px;" required/>                  \n                                <img ng-show="dataLoading === true" src="/images/loading.4a8b692d.svg" \n                                    alt="..." style="width: 5%; height: 5%"/>\n                                <div>\n                                    <div ng-messages="bookingDetailForm.$error" style="color:maroon" role="alert">\n                                        <div ng-message="required">{{\'CALENDAR_FORM_ERROR\' | i18n}}</div>\n                                    </div>\n                                    <div ng-show="booking.day === undefined" style="color:maroon;" role="alert">\n                                        {{\'CALENDAR_SELECTED_DAY_ERROR\' | i18n}}\n                                    </div>\n                                </div>\n                                <a ng-click="calendarCtrl.deleteBooking()" style="padding:0px;margin:0px;">\n                                <button ng-show="booking.bookedBy === username && dataLoading !== true && isExistingBookingSelected" \n                                    class="btn btn-danger" style="white-space: normal;padding:4px;margin:0px;margin-top:3px;margin-bottom:3px" >\n                                {{\'CALENDAR_DELETE_BOOKING_LABEL\' | i18n}}\n                                </button>\n                                </a>\n                                <a ng-click="calendarCtrl.validateBooking()" style="padding:0px;">\n                                <button ng-show="isAdmin && isExistingBookingSelected && !booking.isValidated"\n                                    class="btn btn-info" style="white-space: normal;margin: 3px;" >\n                                {{\'CALENDAR_VALIDATE_BOOKING_LABEL\' | i18n}}\n                                </button>\n                                </a>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div id="bookersInfo" class="panel-group" style="overflow: auto;">\n                <div class="panel panel-default">\n                    <div class="panel-heading" style="padding: 5px;">\n                        <p data-toggle="collapse" href="#bookersCollapse" class="panel-title" style="font-size:14px;">\n                            {{\'CALENDAR_BOOKERS\' | i18n}}\n                        </p>\n                    </div>\n                    <div id="bookersCollapse" class="panel-collapse collapse">\n                        <ul class="list-group">\n                            <li ng-repeat="booker in bookerColorsStyles track by $index" \n                                class="list-group-item" \n                                style="padding:5px;"\n                                ng-hide="booker.booker === \'\'">\n                                {{booker.booker}}\n                                <span class="glyphicon glyphicon-stop" \n                                    ng-style="{color:booker.color}"\n                                    style="padding:0px;float: right;"></span>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="innerCalendarHeaderPage" style="margin: 0;margin-bottom:10px;width:85%;float: right;" >\n      <div class="innerCalendarHeaderContent">\n         <ul class="nav nav-pills" style="margin-bottom:15px;">\n            <li role="presentation" \n                class="dropdown" \n                ng-repeat="(building, buildingRooms) in buildingsRooms track by $index" \n                ng-class="{active: building === currentBuilding}">\n                <a class="dropdown-toggle" style="padding:5px;margin:0px;display:inline;" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" >\n                {{building}}<span class="caret"style="padding:1px;"></span>\n                </a>\n                <ul class="dropdown-menu" >\n                    <li ng-repeat="room in buildingRooms.buildingRooms track by $index" \n                        ng-class="{active: room === currentRoom}"\n                        >\n                        <a data-toggle="tab"\n                            style="padding:5px;margin:0px;display:inline;"  \n                            ng-click="calendarCtrl.selectRoom(room, building)">{{room}}</a>\n                    </li>\n                </ul>\n            </li>\n        </ul>\n        <p>\n            {{weekStartEndDates}}\n            <button class="btn btn-default" style="padding:3px;" ng-click="calendarCtrl.initWeekData(calendarCtrl.todayMonth, calendarCtrl.todayYear)">\n            {{\'TODAY_LABEL\' | i18n}}\n            </button>\n        </p>\n        <div >\n            <table class="table-responsive table-bordered table-hover" \n                style="margin: 0px;width:100%;" border>\n                <tr class="active" >\n                    <th style="width:2%;"></th>\n                    <th style="text-align: center;width:14%;" ng-repeat="day in calendarCtrl.daysDisplay track by $index">{{ day }}</th>\n                </tr>\n            </table>\n            </div>\n     </div>\n  </div>\n        <div class="innerCalendarPage" style="margin: 0;margin-bottom:10px;width:85%;float: right;">\n            <div class="innerCalendarContent"\n                style="margin: 0;overflow: auto;border-bottom: 1px solid #e5e5e5;border-top: 1px solid #e5e5e5;">\n                <table id="bookingsSlotsTable" class="table-responsive table-bordered table-hover" style="margin: 0;width:100%;">\n                    <tbody style="border-top: none;">\n                        <tr ng-repeat="schedule in calendarCtrl.schedules track by $index">\n                            <td style="width:2%;text-align: center;" rowspan = "2" \n                                ng-hide="schedule === 24 || $index%2 !== 0">\n                                {{calendarCtrl.schedulesLabels[$index]}}\n                            </td>\n                            <td ng-hide="schedule === 24" \n                                style="padding:0px;width:14%;overflow:hidden;"\n                                ng-repeat="day in calendarCtrl.days track by $index" \n                                class="noselect upperBorderDotted" \n                                ng-class="{selectBookingSlot: calendarCtrl.isSelectBookingSlotClass(schedule, day)}">\n                                <div style="width:92%;height: 20px; max-height:20px;float: left;">\n                                    <table id="bookingsTable" style="margin-bottom: 0px;" class="table noselect">\n                                        <tbody>\n                                            <tr>\n                                                <td ng-repeat="bookingForSchedule in calendarCtrl.getScheduleBookedBy(day, week, year, schedule) track by $index"\n                                                    ng-click="calendarCtrl.selectBookingInDB(bookingForSchedule.split(\'$\')[1])"\n                                                    ng-class="{validatedBooking: calendarCtrl.isBookingValidated(bookingForSchedule.split(\'$\')[1])}"\n                                                    style="height: 20px; max-height:20px;padding:0px;overflow:auto;word-break: break-all;"\n                                                    ng-mouseup="calendarCtrl.mouseUp()"\n                                                    class="noselect"\n                                                    bgcolor="{{calendarCtrl.applyBookingColor(bookingForSchedule)}}"\n                                                    id="{{bookingForSchedule.split(\'$\')[1]}}">\n                                                    {{bookingForSchedule.split(\'$\')[0]}}\n                                                </td>\n                                                <td ng-show="calendarCtrl.hasBookingForSlot(day, week, year, schedule) === false"\n                                                    style="height: 20px; max-height:20px;padding:0px;overflow:hidden;border-top:none;word-break: break-all;"\n                                                    ng-mouseenter="calendarCtrl.mouseEnter(schedule, day)"\n                                                    ng-mousedown="calendarCtrl.mouseDown(day, week, year, schedule)"\n                                                    ng-mouseup="calendarCtrl.mouseUp()"\n                                                    >\n                                                </td>\n                                            </tr>\n                                        </tbody>\n                                    </table>\n                                </div >\n                                <div style="width:8%;height: 20px; max-height:20px;float: right;"\n                                    ng-mouseenter="calendarCtrl.mouseEnter( schedule, day)" \n                                    ng-mousedown="calendarCtrl.mouseDown(day, week, year, schedule)" \n                                    ng-mouseup="calendarCtrl.mouseUp()" \n                                    >\n                                </div>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n     </div>\n    </div>\n</div>\n\n'),
a.put("views/freeSlot.html",'<div class="container-fluid table-responsive" ng-init="freeSlotCtrl.initSearch()">\n    <div class="alert alert-danger" ng-show="error !== undefined" style="padding:2px;margin-bottom:2px;">\n         {{error}}\n         <a style="float: right" ng-click="removeErrorMessage()">x</a>\n   </div>\n   <div class="alert alert-success" ng-show="message !== undefined" style="padding:2px;margin-bottom:2px;">\n         {{message}}\n         <a style="float: right" ng-click="removeMessage()">x</a>\n   </div>\n   <div class="alert alert-success" ng-show="messageAdmin !== undefined" style="padding:2px;margin-bottom:2px;">\n         {{messageAdmin}}\n         <a style="float: right" ng-click="removeMessageAdmin()">x</a>\n   </div>\n    <div id="calendarDays" class="container-fluid" style="float:left;width:20%;">\n        <table class="table-responsive table-hover" \n            style="margin-left: 2px;margin-bottom:5px;padding:0px;width:100%;" align="center">\n            <tr>\n                <td >\n                    <button ng-click="freeSlotCtrl.initWeekData(freeSlotCtrl.date.month()-1)"><</button>\n                </td>\n                <td colspan="5" style="text-align:center;padding:2px;">\n                    {{freeSlotCtrl.date.format("MMMM YYYY")}}\n                </td>\n                <td colspan="2">\n                    <button ng-click="freeSlotCtrl.initWeekData(freeSlotCtrl.date.month()+1)">></button>\n                </td>\n            </tr>\n            <tr>\n                <th style="text-align:center;padding:2px;margin-right:5px;">\n                   {{\'AGENDA_DAY1_LABEL\' | i18n}}\n                </th>\n                <th style="text-align:center;padding:2px;margin-right:5px;">\n                   {{\'AGENDA_DAY2_LABEL\' | i18n}}\n                </th>\n                <th style="text-align:center;padding:2px;margin-right:5px;">\n                   {{\'AGENDA_DAY3_LABEL\' | i18n}}\n                </th>\n                <th style="text-align:center;padding:2px;margin-right:5px;">\n                   {{\'AGENDA_DAY4_LABEL\' | i18n}}\n                </th>\n                <th style="text-align:center;padding:2px;margin-right:5px;">\n                   {{\'AGENDA_DAY5_LABEL\' | i18n}}\n                </th>\n                <th style="text-align:center;padding:2px;margin-right:5px;">\n                   {{\'AGENDA_DAY6_LABEL\' | i18n}}\n                </th>\n                <th style="text-align:center;padding:2px;margin-right:5px;">\n                   {{\'AGENDA_DAY7_LABEL\' | i18n}}\n                </th>\n            </tr>\n            <tr ng-repeat="monthWeek in freeSlotCtrl.monthWeeks track by $index" align="center">\n                <td ng-repeat="monthDay in monthWeek.monthDays track by $index" \n                    ng-class="{selectedClass: freeSlotCtrl.selectedDay === monthDay.day && freeSlotCtrl.selectedMonth === monthDay.month && freeSlotCtrl.selectedYear === monthWeek.year, todayClass:freeSlotCtrl.todayDate === monthDay.day && freeSlotCtrl.todayMonth === monthDay.month && freeSlotCtrl.todayYear === monthWeek.year}" \n                    ng-click="freeSlotCtrl.selectDay(monthDay, monthWeek.week,monthWeek.year)" \n                    style="margin: 5px;padding:2px;font-weight: normal;text-align:center;" >\n                    {{monthDay.day}}\n                </td>\n            </tr>\n        </table>\n    \n	    <div id="comonInfo" style="margin-bottom:20px;width:100%;">\n	    	<p>\n	    		<button ng-click="freeSlotCtrl.initWeekData(freeSlotCtrl.todayMonth, freeSlotCtrl.todayYear)">\n        			{{\'TODAY_LABEL\' | i18n}}\n      			</button>\n      		</p>\n	        <p>{{\'FREE_SLOT_SELECTED_DAY_LABEL\' | i18n}} {{freeSlotCtrl.day}}</p>\n	    </div>\n	    <form name="searchFreeSlotForm"\n	    style="width:100%;"\n	        ng-submit="searchFreeSlotForm.$valid && freeSlotCtrl.searchFreeSlot()" novalidate>\n	        <div class="input-group">\n	            <div  style="width:50%;float: left;margin-bottom:20px;">\n	                <label style="">{{\'FREE_SLOT_SCHEDULE_FROM_LABEL\' | i18n}}</label><br>\n	                <select ng-model="freeSlotCtrl.scheduleStart" required>\n	                    <option ng-repeat="timeStart in freeSlotCtrl.schedules track by $index"\n                      ng-disabled="freeSlotCtrl.scheduleEnd !== undefined && timeStart >= freeSlotCtrl.scheduleEnd"\n                       value="{{timeStart}}">{{freeSlotCtrl.schedulesLabels[$index]}}</option>\n	                </select>\n	            </div>\n	            <div style="width:50%;float: right;margin-bottom:20px;">\n	                <label>{{\'FREE_SLOT_SCHEDULE_TO_LABEL\' | i18n}}</label><br>\n	                <select ng-model="freeSlotCtrl.scheduleEnd" required>\n	                    <option ng-repeat="timeEnd in freeSlotCtrl.schedules track by $index" \n                      ng-disabled="freeSlotCtrl.scheduleStart !== undefined && timeEnd <= freeSlotCtrl.scheduleStart"\n                      value="{{timeEnd}}">{{freeSlotCtrl.schedulesLabels[$index]}}</option>\n	                </select>\n	            </div>\n	        </div>\n	        <input class="btn btn-success" ng-hide="dataLoading === true" type="submit" value="{{\'FREE_SLOT_SEARCH_LABEL\' | i18n}}" style="margin-bottom:20px;" required/>                  \n	        <img ng-show="dataLoading === true" src="/images/loading.4a8b692d.svg" \n	            alt="..." style="width: 5%; height: 5%"/>\n          <div>\n              <div ng-messages="searchFreeSlotForm.$error" style="color:maroon" role="alert">\n                 <div ng-message="required">{{\'FREE_SLOT_FORM_ERROR\' | i18n}}</div>\n              </div>\n           </div>\n	    </form>\n	    \n	</div>\n	<div id="listFreeRoomsForSlot"\n	ng-show="availableRooms !== undefined && dataLoading === false"\n	style="float:right;width:80%;">\n	        <p ng-show="availableRooms.length <= 0">{{\'FREE_SLOT_NO_ROOM_MESSAGE\' | i18n}}</p>\n	        <p ng-show="availableRooms.length > 0">{{\'FREE_SLOT_FREE_ROOM_LABEL\' | i18n}}</p>\n	        <ul class="list-group" ng-show="availableRooms.length > 0">\n	            <li class="list-group-item" ng-repeat="availableRoom in availableRooms">\n	                <p>\n	                	{{availableRoom}}\n		                <a ng-click="freeSlotCtrl.bookFreeSlot(availableRoom, $index)"\n		                	ng-show="username !== undefined && slotsStatuses[$index].isLoadingData !== true && slotsStatuses[$index].isNewlyBooked !== true"\n	                    	style="float: right;margin-left:5px;">\n	                        <button class="btn btn-info" style="vertical-align:middle;">\n	                            {{\'FREE_SLOT_BOOK_ROOM_LABEL\' | i18n}}\n	                        </button>\n	                    </a>\n	                    <img ng-show="slotsStatuses[$index].isLoadingData === true" src="/images/loading.4a8b692d.svg" style="width: 2%; height: 2%;float: right;"\n		            alt="..." />\n	                    <button class="btn btn-success" \n								ng-show="username !== undefined && slotsStatuses[$index].isLoadingData !== true && slotsStatuses[$index].isNewlyBooked === true"\n	                    		style="vertical-align:middle;float: right;">\n	                        {{\'FREE_SLOT_ROMM_BOOKED_MESSAGE\' | i18n}}\n	                    </button>\n                    </p>\n	            </li>\n	        </ul>\n	    </div>\n\n</div>\n\n'),a.put("views/login.html",'<div class="col-md-6 col-md-offset-3" ng-init="loginCtrl.initLoginController()"> <h2>{{\'LOGIN_TITLE\' | i18n}}</h2> <div class="alert alert-danger" ng-show="error !== undefined" style="padding:2px;margin-bottom:2px"> {{error}} <a style="float: right" ng-click="removeErrorMessage()">x</a> </div> <div class="alert alert-success" ng-show="message !== undefined" style="padding:2px;margin-bottom:2px"> {{message}} <a style="float: right" ng-click="removeMessage()">x</a> </div> <div class="alert alert-success" ng-show="messageAdmin !== undefined" style="padding:2px;margin-bottom:2px"> {{messageAdmin}} <a style="float: right" ng-click="removeMessageAdmin()">x</a> </div> <form name="form" ng-submit="loginCtrl.login()" role="form"> <div class="form-group"> <label for="username">{{\'LOGIN_USERNAME_LABEL\' | i18n}}</label> <input type="text" name="username" id="username" class="form-control" ng-model="username" required> </div> <div class="form-group"> <label for="password">{{\'LOGIN_PASSWORD_LABEL\' | i18n}}</label> <input type="password" name="password" id="password" class="form-control" ng-model="loginCtrl.password" required> </div> <div class="form-actions"> <button ng-hide="dataLoading === true" type="submit" ng-disabled="form.$invalid || loginCtrl.dataLoading" class="btn btn-primary">{{\'LOGIN_LOGIN_LABEL\' | i18n}}</button> <img ng-show="dataLoading === true" src="/images/loading.4a8b692d.svg" alt="..." style="width: 5%; height: 5%"> <a href="/register" class="btn btn-link">{{\'LOGIN_REGISTER_LABEL\' | i18n}}</a> </div> </form> </div>'),a.put("views/main.html",'<div class="container-fluid table-responsive" ng-init="calendarCtrl.initCalendar()">\n   <div   class="container" style="overflow-y:auto;overflow-x: hidden;height: 620px !important;font-size:12px;margin: 0;padding:0px;width:14.5%;float: left;">\n      <table class="table-responsive table-hover" \n         style="margin-left: 4px;margin-bottom:5px;padding:0px;width:18%;" align="center">\n         <tr>\n            <td >\n              <button ng-click="calendarCtrl.initWeekData(calendarCtrl.date.month()-1)"><</button>\n            </td>\n            <td colspan="5" style="text-align:center;padding:2px;">\n               {{calendarCtrl.date.format("MMMM YYYY")}}\n            </td>\n            <td colspan="2">\n              <button ng-click="calendarCtrl.initWeekData(calendarCtrl.date.month()+1)">></button>\n            </td>\n         </tr>\n         <tr>\n            <th style="text-align:center;padding:2px;margin-right:5px;">\n               lu.\n            </th>\n            <th style="text-align:center;padding:2px;margin-right:5px;">\n               ma.\n            </th>\n            <th style="text-align:center;padding:2px;margin-right:5px;">\n               me.\n            </th>\n            <th style="text-align:center;padding:2px;margin-right:5px;">\n               je.\n            </th>\n            <th style="text-align:center;padding:2px;margin-right:5px;">\n               ve.\n            </th>\n            <th style="text-align:center;padding:2px;margin-right:5px;">\n               sa.\n            </th>\n            <th style="text-align:center;padding:2px;margin-right:5px;">\n               di.\n            </th>\n         </tr>\n         <tr ng-repeat="monthWeek in calendarCtrl.monthWeeks" ng-click="calendarCtrl.setWeek($index)" align="center">\n            <th ng-class="{selectedWeekClass: week === monthWeek.week, todayWeekClass:monthWeek.week===calendarCtrl.todayWeek}" ng-repeat="monthDay in monthWeek.monthDays" \n               style="margin: 5px;padding:2px;font-weight: normal;text-align:center;" >\n               {{monthDay.day}}\n            </th>\n         </tr>\n      </table>\n      <div id="bookingInfo">\n         <div class="panel-group">\n            <div class="panel panel-default">\n               <div class="panel-heading" style="padding: 5px;">\n                  <p class="panel-title" style="font-size:14px;">\n                     R&eacute;servation\n                  </p>\n               </div>\n               <div id="bookingFormColl" class="panel-collapse collapse in" style="margin-left: 5px;">\n                  <form name="bookingDetailForm" ng-hide="booking == null" \n                     ng-submit="bookingDetailForm.$valid && calendarCtrl.addBooking()" novalidate>\n                     <div class="input-group" >\n                        <label>R&eacute;servation :</label>\n                        <select style="width:90%;" ng-model="booking.day">\n                           <option ng-repeat="day in calendarCtrl.days" value="{{day}}">{{day}}</option>\n                        </select>\n                     </div>\n                     <div class="input-group">\n                        <div  style="width:50%;float: left;">\n                           <label style="">De :</label>\n                           <select ng-model="booking.scheduleStart">\n                              <option ng-repeat="timeStart in calendarCtrl.schedules" value="{{timeStart}}">{{calendarCtrl.schedulesLabels[$index]}}</option>\n                           </select>\n                        </div>\n                        <div style="width:50%;float: right;">\n                           <label>&Agrave; :</label><br>\n                           <select ng-model="booking.scheduleEnd">\n                              <option ng-repeat="timeEnd in calendarCtrl.schedules" value="{{timeEnd}}">{{calendarCtrl.schedulesLabels[$index]}}</option>\n                           </select>\n                        </div>\n                     </div>\n                     <div class="input-group">\n                        <label>Salle :</label>\n                        <input style="width:90%;" type="text" name="room" ng-model="currentRoom" required /> \n                     </div>\n                     <div class="input-group">\n                        <label>R&eacute;serv&eacute; par :</label>\n                        <input style="width:90%;" type="text" name="bookedBy" ng-model="booking.bookedBy" required />\n                     </div>\n                     <div class="input-group">\n                        <label>R&eacute;servation :</label>\n                        <input type="checkbox" name="isValidated" ng-model="booking.isValidated"/> Valid&eacute;e\n                     </div>\n                     <input type="submit" value="Submit" required/>\n                  </form>\n               </div>\n            </div>\n         </div>\n      </div>\n      <div id="roomsInfo" class="panel-group" style="overflow: auto;">\n         <div class="panel panel-default">\n            <div class="panel-heading" style="padding: 5px;">\n               <p data-toggle="collapse" href="#roomsCollapse" class="panel-title" style="font-size:14px;">\n                  Salles\n               </p>\n            </div>\n            <div id="roomsCollapse" class="panel-collapse collapse">\n               <ul class="list-group">\n                  <li ng-repeat="room in rooms" \n                     class="list-group-item"\n                     ng-class="{selectedRoom: room.room === currentRoom}" \n                     \n                     style="padding:5px;">\n                     <a style="display:block;" ng-click="calendarCtrl.selectRoom($index)">\n                      <span style="text-decoration: none;display: inline-block;">\n                        {{room.room}}\n                      </span>\n                     </a>\n                     \n                  </li>\n               </ul>\n            </div>\n         </div>\n      </div>\n      <div id="bookersInfo" class="panel-group" style="overflow: auto;">\n         <div class="panel panel-default">\n            <div class="panel-heading" style="padding: 5px;">\n               <p data-toggle="collapse" href="#bookersCollapse" class="panel-title" style="font-size:14px;">\n                  Associations\n               </p>\n            </div>\n            <div id="bookersCollapse" class="panel-collapse collapse">\n               <ul class="list-group">\n                  <li ng-repeat="booker in bookerColorsStyles" \n                     class="list-group-item" \n                     style="padding:5px;"\n                     ng-hide="booker.booker === \'\'">\n                     {{booker.booker}}\n                     <span class="glyphicon glyphicon-stop" \n                        ng-style="{color:booker.color}"\n                        style="padding:0px;float: right;"></span>\n                  </li>\n               </ul>\n            </div>\n         </div>\n      </div>\n\n   </div>\n   <div style="margin: 0;margin-bottom:10px;height: 600px !important;width:85%;float: right;" >\n      <div>\n        <p>\n          {{weekStartEndDates}}\n          <button ng-click="calendarCtrl.initWeekData(calendarCtrl.todayMonth)">\n            Aujourd\'hui\n          </button>\n        </p>\n         <table class="table-responsive table-bordered table-hover" style="margin: 0;width:98.5%;" border>\n            <tr class="active" >\n               <th style="width:2%;"></th>\n               <th style="text-align: center;width:14%;" ng-repeat="day in calendarCtrl.days">{{ day }}</th>\n            </tr>\n         </table>\n         <div style="height:10px;">\n         </div>\n      </div>\n      <div style="margin: 0;overflow: auto;height: 550px !important;border-bottom: 1px solid #e5e5e5;border-top: 1px solid #e5e5e5;">\n         <table class="table-responsive table-bordered table-hover" style="margin: 0;width:100%;" border>\n            <tbody style="border-top: none;">\n               <tr ng-repeat="schedule in calendarCtrl.schedules">\n                  <td style="width:2%;" rowspan = "2" ng-hide="schedule === 24 || $index%2 !== 0">\n                    {{calendarCtrl.schedulesLabels[$index]}}\n                  </td>\n                  <td ng-hide="schedule === 24" \n                     style="padding:0px;width:14%;overflow:hidden;"\n                     ng-repeat="day in calendarCtrl.days" \n                     class="noselect upperBorderDotted" \n                     ng-class="{selectBookingSlot: calendarCtrl.isSelectBookingSlotClass(schedule, day)}">\n                     <div style="width:92%;height: 20px; max-height:20px;float: left;">\n                        <table style="margin-bottom: 0px;" class="table noselect">\n                           <tbody style="border-top: none;">\n                              <tr>\n                                 <td ng-repeat="bookingForSchedule in calendarCtrl.getScheduleBookedBy(day, week, year, schedule)"\n                                    ng-click="calendarCtrl.selectBookingInDB(bookingForSchedule.split(\'$\')[1])"\n                                    ng-class="{noselect: true}"\n                                    style="height: 20px; max-height:20px;padding:0px;overflow:hidden;"\n                                    class="noselect upperBorderDotted"\n                                    bgcolor="{{calendarCtrl.applyBookingColor(bookingForSchedule)}}"\n                                    id="{{bookingForSchedule.split(\'$\')[1]}}">\n                                    {{bookingForSchedule.split(\'$\')[0]}}\n                                 </td>\n                                 <td ng-show="calendarCtrl.hasBookingForSlot(day, week, year, schedule) === false"\n                                 style="height: 20px; max-height:20px;padding:0px;overflow:hidden;border-top:none;"\n                                 ng-mouseenter="calendarCtrl.mouseEnter( schedule, day)"\n                                 ng-mouseup="calendarCtrl.mouseUp()"\n                                 ng-mousedown="calendarCtrl.mouseDown(day, week, year, schedule)" >\n                                 </td>\n                              </tr>\n                           </tbody>\n                        </table>\n                     </div >\n                     <div ng-mouseenter="calendarCtrl.mouseEnter( schedule, day)" \n                     ng-mouseup="calendarCtrl.mouseUp()" \n                     ng-mousedown="calendarCtrl.mouseDown(day, week, year, schedule)" \n                     style="width:8%;height: 20px; max-height:20px;float: right;">\n                     </div>                     \n                  </td>\n               </tr>\n            </tbody>\n         </table>\n      </div>\n   </div>\n   <div ng-model="booking">\n      <h1>{{booking}}</h1>\n   </div>\n   <div ng-repeat="booking in calendar track by $index">\n      {{booking}}\n   </div>\n</div>'),a.put("views/periodicBooking.html",'<div class="container-fluid table-responsive" ng-init="periodicBookingCtrl.initPeriodicBooking()">\n    <div class="alert alert-danger" ng-show="error !== undefined" style="padding:2px;margin-bottom:2px;">\n         {{error}}\n         <a style="float: right" ng-click="removeErrorMessage()">x</a>\n   </div>\n   <div class="alert alert-success" ng-show="message !== undefined" style="padding:2px;margin-bottom:2px;">\n         {{message}}\n         <a style="float: right" ng-click="removeMessage()">x</a>\n   </div>\n   <div class="alert alert-success" ng-show="messageAdmin !== undefined" style="padding:2px;margin-bottom:2px;">\n         {{messageAdmin}}\n         <a style="float: right" ng-click="removeMessageAdmin()">x</a>\n   </div>\n   <div>\n   <div id="calendarStartDays" class="col-xs-6 col-md-4">\n      <table id="selectStartingDay" class="table-responsive table-hover" \n            style="margin-left: 2px;margin-bottom:5px;padding:0px;width:100%;" align="center">\n         <tr>\n             <td >\n                 <button ng-click="periodicBookingCtrl.initWeekData(periodicBookingCtrl.dateStart.month()-1, true)"><</button>\n             </td>\n             <td colspan="5" style="text-align:center;padding:2px;">\n                 {{periodicBookingCtrl.dateStart.format("MMMM YYYY")}}\n             </td>\n             <td colspan="2">\n                 <button ng-click="periodicBookingCtrl.initWeekData(periodicBookingCtrl.dateStart.month()+1, true)">></button>\n             </td>\n         </tr>\n         <tr>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY1_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY2_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY3_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY4_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY5_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY6_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY7_LABEL\' | i18n}}\n             </th>\n         </tr>\n         <tr ng-repeat="monthWeek in periodicBookingCtrl.monthWeeks[0] track by $index" align="center">\n             <td ng-repeat="monthDay in monthWeek.monthDays track by $index" \n                 ng-class="{selectedClass: periodicBookingCtrl.selectedStartDay === monthDay.day && periodicBookingCtrl.selectedStartMonth === monthDay.month && periodicBookingCtrl.selectedStartYear === monthWeek.year,\n                  todayClass:periodicBookingCtrl.todayDate === monthDay.day && periodicBookingCtrl.todayMonth === monthDay.month && periodicBookingCtrl.todayYear === monthWeek.year}" \n                 ng-click="periodicBookingCtrl.selectStartingDay(monthDay, monthWeek.week,monthWeek.year)" \n                 style="margin: 5px;padding:2px;font-weight: normal;text-align:center;" >\n                 {{monthDay.day}}\n             </td>\n         </tr>\n      </table>\n   </div>\n   <div id="calendarEndDays" class="col-xs-6 col-md-4">\n      <table id="SelectEndingDay" class="table-responsive table-hover" \n            style="margin-left: 2px;margin-bottom:5px;padding:0px;width:100%;" align="center">\n         <tr>\n             <td >\n                 <button ng-click="periodicBookingCtrl.initWeekData(periodicBookingCtrl.dateEnd.month()-1, false)"><</button>\n             </td>\n             <td colspan="5" style="text-align:center;padding:2px;">\n                 {{periodicBookingCtrl.dateEnd.format("MMMM YYYY")}}\n             </td>\n             <td colspan="2">\n                 <button ng-click="periodicBookingCtrl.initWeekData(periodicBookingCtrl.dateEnd.month()+1, false)">></button>\n             </td>\n         </tr>\n         <tr>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY1_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY2_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY3_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY4_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY5_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY6_LABEL\' | i18n}}\n             </th>\n             <th style="text-align:center;padding:2px;margin-right:5px;">\n                {{\'AGENDA_DAY7_LABEL\' | i18n}}\n             </th>\n         </tr>\n         <tr ng-repeat="monthWeekEnd in periodicBookingCtrl.monthWeeks[1] track by $index" align="center">\n             <td ng-repeat="monthDayEnd in monthWeekEnd.monthDays track by $index" \n                 ng-class="{selectedClass: periodicBookingCtrl.selectedEndWeek === monthWeekEnd.week && periodicBookingCtrl.selectedEndYear === monthWeekEnd.year,\n                 todayClass:periodicBookingCtrl.todayDate === monthDayEnd.day && periodicBookingCtrl.todayMonth === monthDayEnd.month && periodicBookingCtrl.todayYear === monthWeek.year}" \n                 ng-click="periodicBookingCtrl.selectEndingDay(monthDayEnd, monthWeekEnd.week,monthWeekEnd.year)" \n                 style="margin: 5px;padding:2px;font-weight: normal;text-align:center;" >\n                 {{monthDayEnd.day}}\n             </td>\n         </tr>\n      </table>\n   </div>\n   <div id="perdiodicInfo" class="col-xs-6 col-md-4">\n      <form name="selectSchedulesForm"\n         style="width:100%;"\n        ng-submit="selectSchedulesForm.$valid && periodicBookingCtrl.daysAreSelected() && periodicBookingCtrl.periodicBookingWeeksDuration > 0 && periodicBookingCtrl.addPeriodicBooking()" novalidate>\n        <div class="input-group">\n            <div  style="width:50%;float: left;margin-bottom:20px;">\n                <label style="">{{\'PERIODIC_BOOKING_SCHEDULE_FROM_LABEL\' | i18n}}</label><br>\n                <select ng-model="periodicBookingCtrl.periodicBookingScheduleStart" required>\n                    <option ng-repeat="timeStart in periodicBookingCtrl.schedules track by $index" \n                    ng-disabled="periodicBookingCtrl.periodicBookingScheduleEnd !== undefined && timeStart >= periodicBookingCtrl.periodicBookingScheduleEnd"\n                    value="{{timeStart}}">{{periodicBookingCtrl.schedulesLabels[$index]}}</option>\n                </select>\n            </div>\n            <div style="width:50%;float: right;margin-bottom:20px;">\n                <label>{{\'PERIODIC_BOOKING_SCHEDULE_TO_LABEL\' | i18n}}</label><br>\n                <select ng-model="periodicBookingCtrl.periodicBookingScheduleEnd" required>\n                    <option ng-repeat="timeEnd in periodicBookingCtrl.schedules track by $index" ng-disabled="periodicBookingCtrl.periodicBookingScheduleStart !== undefined && timeEnd <= periodicBookingCtrl.periodicBookingScheduleStart" value="{{timeEnd}}">{{periodicBookingCtrl.schedulesLabels[$index]}}</option>\n                </select>\n            </div>\n        </div>\n        <div class="input-group">\n            <div style="margin-bottom:20px;">\n                <label>{{\'PERIODIC_BOOKING_ROOM_LABEL\' | i18n}}</label><br>\n                <select ng-model="periodicBookingCtrl.periodicBookingRoom" required>\n                     <option ng-repeat="room in rooms track by $index" value="{{room.room}}"> \n                        {{room.room}}\n                     </option>\n                </select>\n            </div>\n        </div>\n        <input ng-disabled="selectSchedulesForm.$invalid || !periodicBookingCtrl.daysAreSelected() || periodicBookingCtrl.periodicBookingWeeksDuration <= 0" class="btn btn-success" ng-hide="dataLoading === true" type="submit" value="{{\'PERIODIC_BOOKING_BOOK_LABEL\' | i18n}}" style="margin-bottom:20px;margin-right:5px;float:left;" required/>                  \n        <img ng-show="dataLoading === true" src="/images/loading.4a8b692d.svg" \n            alt="..." style="width: 5%; height: 5%"/>\n         <div>\n            <div ng-messages="selectSchedulesForm.$error" style="color:maroon" role="alert">\n               <div ng-message="required">{{\'PERIODIC_BOOKING_FORM_ERROR\' | i18n}}</div>\n            </div>\n            <div ng-show="periodicBookingCtrl.daysAreSelected() === false" style="color:maroon;" role="alert">\n               {{\'PERIODIC_BOOKING_SELECTED_DAY_ERROR\' | i18n}}\n            </div>\n            <div ng-show="periodicBookingCtrl.periodicBookingWeeksDuration <= 0" style="color:maroon;" role="alert">\n               {{\'PERIODIC_BOOKING_WEEK_DURATION_ERROR\'| i18n}}\n            </div>\n         </div>\n      </form>\n   \n     <!-- <p>\n         Réservation périodique de <b>{{periodicBookingCtrl.periodicBookingRoom}}</b><br>Les <b>{{periodicBookingCtrl.periodicDay}}</b><br>Du <b>{{periodicBookingCtrl.selectedStartingDate}}</b><br>Au <b>{{periodicBookingCtrl.selectedEndingDate}}</b><br>De <b>{{(periodicBookingCtrl.periodicBookingScheduleStart+\'h\').replace(".5h", "h30")}}</b> à <b>{{(periodicBookingCtrl.periodicBookingScheduleEnd+\'h\').replace(".5h", "h30")}}</b><br>\n         Durée: <b>{{periodicBookingCtrl.periodicBookingWeeksDuration}}</b> semaines\n      </p>-->\n   </div>   \n   </div>\n   <div id="periodicBookings" class="col-xs-12 col-md-12"> \n      <ul id="roomList" class="list-group">\n         <li class="list-group-item" ng-repeat="periodicBooking in formattedPeriodicBookings">\n            <button class="btn btn-danger" ng-click="periodicBookingCtrl.deletePeriodicBooking(periodicBooking.id)" style="float:right;margin-left:5px;">\n               {{\'PERIODIC_BOOKING_DELETE_BOOKING_LABEL\'| i18n}}\n            </button>\n            <button ng-show="isAdmin === true && bookingConflitLoading[periodicBooking.id] !== true &&  !periodicBooking.isValidated" class="btn btn-info" ng-click="periodicBookingCtrl.findConflictedSlotsWithPerdiodicBooking(periodicBooking.id)" style="float:right;margin-left:5px;">\n               {{\'PERIODIC_BOOKING_CHECK_BOOKING_CONFLICTS_LABEL\' | i18n}}\n            </button>\n            <img ng-show="bookingConflitLoading[periodicBooking.id] === true" src="/images/loading.4a8b692d.svg" \n            alt="..." style="width: 5%; height: 5%; float:right;margin-left:5px;"/>\n            <button ng-show="isAdmin === true && nbConflicts[periodicBooking.id] !== undefined && bookingConflitLoading[periodicBooking.id] !== true &&  !periodicBooking.isValidated && nbConflicts[periodicBooking.id] <= 0" class="btn btn-success" ng-click="periodicBookingCtrl.validatePeriodicBooking(periodicBooking.id)" style="float:right;margin-left:5px;">\n               {{\'PERIODIC_BOOKING_VALIDATE_BOOKING_LABEL\'| i18n}}\n            </button>\n            <button ng-show="isAdmin === true && nbConflicts[periodicBooking.id] !== undefined && bookingConflitLoading[periodicBooking.id] !== true &&  !periodicBooking.isValidated && nbConflicts[periodicBooking.id] > 0" class="btn btn-warning" ng-click="periodicBookingCtrl.validatePeriodicBooking(periodicBooking.id)" style="float:right;margin-left:5px;">\n'+"               {{'PERIODIC_BOOKING_VALIDATE_BOOKING_WITH_CONFLICTS_LABEL'| i18n}} <b>{{nbConflicts[periodicBooking.id]}} {{'PERIODIC_BOOKING_CONFLICTS_LABEL' | i18n}}</b>\n            </button>\n  \n\n               {{'PERIODIC_BOOKING_DISPLAY_INTRO_LABEL' | i18n}} <b>{{periodicBooking.room}}</b><br>{{'PERIODIC_BOOKING_DISPLAY_DAY_LABEL' | i18n}} <b>{{periodicBooking.day}}</b><br>{{'PERIODIC_BOOKING_DISPLAY_DAY_START_LABEL'| i18n}} <b>{{periodicBooking.dateStart}}</b><br>{{'PERIODIC_BOOKING_DISPLAY_DAY_END_LABEL' | i18n}} <b>{{periodicBooking.dateEnd}}</b><br>{{'PERIODIC_BOOKING_SCHEDULE_FROM_LABEL' | i18n}} <b>{{periodicBooking.scheduleStart}}</b> {{'PERIODIC_BOOKING_SCHEDULE_TO_LABEL' | i18n}} <b>{{periodicBooking.scheduleEnd}}</b><br>{{'PERIODIC_BOOKING_DISPLAY_DURATION_LABEL' | i18n}} <b>{{periodicBooking.periodicBookingWeeksDuration}}</b> {{'PERIODIC_BOOKING_DISPLAY_WEEK_LABEL' | i18n}}<br>Réserver par: <b>{{periodicBooking.bookedBy}}</b>              \n            </div>\n         </li>\n      </ul>\n   </div>\n      \n</div>"),
a.put("views/register.html",'<div class="col-md-6 col-md-offset-3" ng-init="registerCtrl.initRegisterCtrl()"> <h2>{{\'REGISTER_TITLE\' | i18n}}</h2> <div class="alert alert-danger" ng-show="error !== undefined" style="padding:2px;margin-bottom:2px"> {{error}} <a style="float: right" ng-click="removeErrorMessage()">x</a> </div> <div class="alert alert-success" ng-show="message !== undefined" style="padding:2px;margin-bottom:2px"> {{message}} <a style="float: right" ng-click="removeMessage()">x</a> </div> <div class="alert alert-success" ng-show="messageAdmin !== undefined" style="padding:2px;margin-bottom:2px"> {{messageAdmin}} <a style="float: right" ng-click="removeMessageAdmin()">x</a> </div> <form name="form" ng-submit="registerCtrl.register()" role="form"> <div class="form-group"> <label for="email">{{\'REGISTER_EMAIL_LABEL\' | i18n}}</label> <input type="email" name="email" id="Text1" class="form-control" ng-model="registerCtrl.email" required> </div> <div class="form-group"> <label for="username">{{\'REGISTER_USERNAME_LABEL\' | i18n}}</label> <input type="text" name="username" id="username" class="form-control" ng-model="registerCtrl.username" required> </div> <div class="form-group"> <label for="password">{{\'REGISTER_PASSWORD_LABEL\' | i18n}}</label> <input type="password" name="password" id="password" class="form-control" ng-model="registerCtrl.password" required> </div> <div class="form-group"> <label for="password">{{\'REGISTER_ADMIN_KEY_LABEL\' | i18n}}</label> <input type="password" name="password" id="password" class="form-control" ng-model="registerCtrl.adminToken" required> </div> <div class="form-actions"> <button type="submit" ng-disabled="form.$invalid || registerCtrl.dataLoading" class="btn btn-primary">{{\'REGISTER_REGISTER_LABEL\' | i18n}}</button> <a href="#/login" class="btn btn-link">{{\'REGISTER_CANCEL_LABEL\' | i18n}}</a> </div> </form> </div>'),a.put("views/userConsole.html",'<div class="col-md-10 col-md-offset-2 container-fluid" ng-init="initUser()"> <div class="alert alert-danger" ng-show="error !== undefined" style="padding:2px;margin-bottom:2px"> {{error}} <a style="float: right" ng-click="removeErrorMessage()">x</a> </div> <div class="alert alert-success" ng-show="message !== undefined" style="padding:2px;margin-bottom:2px"> {{message}} <a style="float: right" ng-click="removeMessage()">x</a> </div> <div class="alert alert-success" ng-show="messageAdmin !== undefined" style="padding:2px;margin-bottom:2px"> {{messageAdmin}} <a style="float: right" ng-click="removeMessageAdmin()">x</a> </div> <div class="container-fluid" style="width:100%"> <div> <p> {{\'USER_ACCOUNT_INFORMATION_LABEL\' | i18n}} <a ng-click="userConsoleCtrl.enableUpdateSettings()" ng-show="room.oldName === undefined" style="margin-left:5px"> <button class="btn btn-warning" ng-show="isUpdating === false"> {{\'USER_UPDATE_LABEL\' | i18n}} </button> </a> </p> <form name="userAccountForm" ng-submit="userAccountForm.$valid && userConsoleCtrl.updateBookerSettings()" novalidate> <div class="input-group" style="width:65%"> <label>{{\'USER_USERNAME_LABEL\' | i18n}}</label><br> <input type="text" style="width:65%" ng-model="booker.booker" ng-disabled="isUpdating === false" required> </div> <div class="input-group" style="width:65%"> <label>{{\'USER_EMAIL_LABEL\' | i18n}}</label><br> <input type="email" style="width:65%" ng-model="booker.email" ng-disabled="isUpdating === false" required> </div> <div class="input-group" style="width:65%"> <label>{{\'USER_PASSWORD_LABEL\' | i18n}}</label><br> <input type="password" style="width:65%" ng-model="booker.password" ng-disabled="isUpdating === false" required> </div> <div class="input-group" style="width:65%"> <label>{{\'USER_NEW_PASSWORD_LABEL\' | i18n}}</label><br> <input type="password" style="width:65%" ng-model="booker.newPassword" ng-disabled="isUpdating === false"> </div> <img ng-show="dataLoading === true" src="/images/loading.4a8b692d.svg" alt="..." style="width: 5%; height: 5%"> <input class="btn btn-success" ng-hide="dataLoading === true || isUpdating === false" type="submit" value="Valider" style="margin: 3px" required> </form> </div> </div> </div>')}]);